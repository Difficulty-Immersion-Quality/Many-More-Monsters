--Why did I make so many things oh god
local Null = "NULL_00000000-0000-0000-0000-000000000000"
local MountainGob1 = "MMM_MOUNTAINGOBS_68304a4f-95ae-4a67-8626-5daf30725d5e"
local MountainGob2 = "MMM_MOUNTAINGOBS_5c6525c1-a91d-4d7c-90da-84350bff1a27"
local MountainGob3 = "MMM_MOUNTAINGOBS_bccba48e-7daa-4c97-a742-0c607a8ed33d"
local MountainGob4 = "MMM_MOUNTAINGOBS_10a57eba-31b6-4d1c-b4cb-30a997f15408"
local MountainGob5 = "MMM_MOUNTAINGOBS_567f86aa-33fe-4539-8f5e-27e991daafa8"
local MountainGob6 = "MMM_MOUNTAINGOBS_b0483404-6331-47a7-bdbf-6ce4cb4248f7"
local MountainTrigger1 = "MMM_TRIGGERPOINT_MOUNTAIN_4252845c-6c3c-4720-96ea-6984d5006d60"
local MountainTrigger2 = "MMM_TRIGGERPOINT_MOUNTAIN_98b18ddd-494d-4a42-8ee1-d5eb6cda1836"
local GithTroop1 = "MMM_GITHTROOPS_2f25f6aa-16e8-4477-8de3-593561147a76"
local GithTroop2 = "MMM_GITHTROOPS_2aeb720e-038d-4d07-a49e-7b31d7c52b3e"
local GithTroop3 = "MMM_GITHTROOPS_fc8d0feb-9f2c-4f44-882a-e67c27fda222"
local GithTroop4 = "MMM_GITHTROOPS_781ea218-0da6-4fc2-9146-132a2ddbe02c"
local GithTroop5 = "MMM_GITHTROOPS_569eff9f-7152-45ad-9231-60d2e262cb6d"
local AbsoluteTroop1 = "MMM_ABSOLUTETROOPS_9c7c2e45-8a75-41d5-a2de-8c2d999f172c"
local AbsoluteTroop2 = "MMM_ABSOLUTETROOPS_e3f4450b-b21a-4286-bdcc-4103dd122db6"
local AbsoluteTroop3 = "MMM_ABSOLUTETROOPS_c4697028-cf81-4bcf-97d5-4ac54a90bc39"
local DeathShephard = "S_CRE_CultistsUndead_GiantSkeleton_000_09f52656-f262-48a2-bdbb-949264077dc4"
local GithGondola1 = "MMM_GITHGONDOLA_1c524a48-5618-4115-9653-076dae88cb76"
local GithGondola2 = "MMM_GITHGONDOLA_30db150e-2e0a-4dfa-b142-13ef8e2f0b42"
local GithGondola3 = "MMM_GITHGONDOLA_2c3b16ad-77d1-42b9-8a46-0e52069917fb"
local GithGondola4 = "MMM_GITHGONDOLA_1c4b58c5-ab99-4f8c-b028-48dabff63df2"
local GithGondola5 = "MMM_GITHGONDOLA_9a2c3864-736f-4260-bfa3-c59c49d5938c"
local GithCathGuard1 = "MMM_GITHCATHGUARD_144dd936-a4b9-4ce3-902c-585a840bef62"
local GithCathGuard2 = "MMM_GITHCATHGUARD_fd1482cb-11f7-436d-96c2-a902f29a16b6"
local GithCathGuard3 = "MMM_GITHCATHGUARD_52afecd6-334f-4614-8f41-506565755629"
local GithCathGuard4 = "MMM_GITHCATHGUARD_95577b02-a6d7-4002-af8d-480eb0630bac"
local GithCathGuard5 = "MMM_GITHCATHGUARD_28d28e15-7e69-4bd9-83fd-c191cd5f53b9"
local MountainTriggerDoor = "MMM_TRIGGERPOINT_MOUNTAIN_822f1c67-3d3c-48bd-b748-33dd907e502d"
local ShadowSpawnDoor = "MMM_SHADOWSPAWNDOOR_c0f07a71-a404-43a8-9b61-b082fddefe05"
local CrecheGishra1 = "MMM_GISHRACRECHE_cf1334ef-51dc-4b3e-a78c-51db5bbb2e4a"
local CrecheGishra2 = "MMM_GISHRACRECHE_2a355838-6605-4087-b96c-a592b31eff2d"
local GishCrechTrigger = "MMM_TRIGGERPOINT_MOUNTAIN_96ae372c-defc-4856-82e2-7f7346ee11f0"
local MonestaryHarpy1 = "MMM_MONESTARYHARPY_9f1dc8ea-9f21-41b7-8ba0-e0275fb0821c"
local MonestaryHarpy2 = "MMM_MONESTARYHARPY_ce4caab9-0d94-4839-bb6e-7c6c53594244"
local MonestaryHarpy3 = "MMM_MONESTARYHARPY_9fbd570d-e564-457c-86fb-c8be2a2b894a"
local PicnicKob1 = "MMM_PICNICKOBS_f1ded2a0-26b6-4854-b8bc-aa373c5a9589"
local PicnicKob2 = "MMM_PICNICKOBS_6c8746e0-c539-48da-bc7e-266f65bc606e"
local SpiritualMonestary1 = "MMM_SPIRITUALMONESTARY_f2f64925-6a13-485a-8c2b-6064e43053c8"
local SpiritualMonestary2 = "MMM_SPIRITUALMONESTARY_3d4b7ed4-851f-4028-b492-c6d0057197a0"
local SpiritualMonestary3 = "MMM_SPIRITUALMONESTARY_56886dc3-34ad-4062-98be-0e5d277f863c"
local SpiritualMonestary4 = "MMM_SPIRITUALMONESTARY_16731ec4-2a31-419f-97c4-903fd6f127b2"
local EstherMerc1 = "MMM_ESTHERMERC_54ce2dee-7a19-4192-8687-b1d3a84b8c9e"
local EstherMerc2 = "MMM_ESTHERMERC_b3d4d2e6-a6fe-4860-a951-3f893633f716"
local Dawnmaster = "MMM_DAWNMASTER_e4c919df-5e52-4a68-ab65-4d550debfcdb"
local MountainChicken = "MMM_CHICKENRUN_42bd9bf1-80d8-42ee-a9a1-312ce9e630a0"
local MadHandSorc = "MMM_MADHANDS_9b0e491e-b6ed-4a34-b8aa-b1affdee7707"
local MadHand1 = "MMM_MADHANDS_2ed07b70-c98c-4aa3-92cc-1a628524334d"
local MadHand2 = "MMM_MADHANDS_a1213f8b-9d93-4f78-a7ec-3b4d42a3ddd6"
local MadHand3 = "MMM_MADHANDS_f72d64a4-d593-444f-878c-80e62694ac25"
local MadHand4 = "MMM_MADHANDS_e3c811cc-8e15-46e6-9b85-47a66078d6be"
local MadHand5 = "MMM_MADHANDS_501cf501-814b-4656-9da0-08f633dd411a"
local MadHand6 = "MMM_MADHANDS_3a9ddbd4-2be3-4f55-8299-0485df990124"
local MadHand7 = "MMM_MADHANDS_82394b4f-7994-4364-ba75-83b964738894"
local MadHand8 = "MMM_MADHANDS_53d0c3f6-0911-4aac-9562-6effe3e3febb"
local Prisoner1 = "MMM_GITHPRISONER_be856487-d5f9-4b54-992f-6ea6cb1e8c01"
local Prisoner2 = "MMM_GITHPRISONER_20be8a27-01a3-49e0-9235-7c4262973384"
local Prisoner3 = "MMM_GITHPRISONER_4c962fec-81ef-4565-8984-9fc663696b05"
local CrecheCheckpoint = "S_CRE_MainCheckpointMainGuard_161701af-17b7-4def-b378-5f24e95d667f"
local Act1BMimic = "MMM_ACT1MIMIC_de1e25f5-fa08-430a-aaf8-e0cc80406ba6"
local GondolaLever = "S_CRE_ElevatorUpLever_000_c4d746c1-22e4-4dfd-9be9-33e40428850a"
local Adam1b = "MMM_THIEFTRIO1B_54e633bb-07f6-467e-b7a5-f2293d7ecee4"
local Liam1b = "MMM_THIEFTRIO1B_f7b34dfd-62e2-488e-bd9b-e04ac9b4b4f9"
local Mike1b = "MMM_THIEFTRIO1B_7ad4c9dd-4a91-4b41-b724-7dec947855e1"

--Mimic Chests
local Act1BChest1 = "MMM_ACT1BCHEST_22aca5c2-6335-4161-833d-a809e1455554"
local Act1BChest2 = "MMM_ACT1BCHEST_c0fec1c4-45ad-457f-b677-5916e3654866"
local Act1BChest3 = "MMM_ACT1BCHEST_e91c0289-438d-4353-be34-3e9aee9e78d3"
local Act1BChest4 = "MMM_ACT1BCHEST_48788b47-4a51-4ae7-a31d-5280183714d8"
local Act1BChest5 = "MMM_ACT1BCHEST_d922bfae-1d48-457f-af5e-007afd466397"
local Act1BChest6 = "MMM_ACT1BCHEST_e8c10bb7-9cc6-4fd7-8988-f9f3a2f66779"
local Act1BChest7 = "MMM_ACT1BCHEST_954a4263-46c7-409d-8c79-d69f953f47aa"
local Act1BChest8 = "MMM_ACT1BCHEST_19a27cb0-e783-4a12-91ae-ca4d9a0405ff"
local Act1BChest9 = "MMM_ACT1BCHEST_cab7d4e4-2064-4922-94de-5f2c537d65c2"

--Items
local MountainMine1 = "PUZ_CONST_GTY_Mine_A_000_7d81e391-6328-4d08-bad1-a5c233d4f8fa"
local MountainMine2 = "PUZ_CONST_GTY_Mine_A_001_59e7a534-fc60-4419-b9aa-edc2e5abc43a"
local MountainMine3 = "PUZ_CONST_GTY_Mine_A_002_8b1c284a-3c0b-41ed-b9eb-e1a6de1f742e"
local MountainMine4 = "PUZ_CONST_GTY_Mine_A_003_136ae96b-cf0a-4a4e-b9aa-f3a75aeebeee"
local MountainMine5 = "PUZ_CONST_GTY_Mine_A_004_072acd27-f11d-400a-a0f5-b8dc01cbdf58"
local MountainMine6 = "PUZ_CONST_GTY_Mine_A_005_e823c684-aab4-435b-8a11-6e90dd57652b"

--Factions
local FNeutralGith = "a51f68a3-e53a-4784-ba02-8d465b781646"
local FHostileGith = "ae4c996b-5040-4c68-b682-0314e0334d35"
local FAbsoluteUndead = "60749034-59cb-4551-b5ea-07d1edd617a9"
local FOrpheusGish = "ACT2B_INT_Orpheus_ad62a159-c6fb-43ae-a682-63c139905874"
local FCrecheCP = "Act1B_CRE_Gith_MainCheckpoint_a51f68a3-e53a-4784-ba02-8d465b781646"
local FNeutral = "cfb709b3-220f-9682-bcfb-6f0d8837462e"

--Flags
local InitiateAct1b = "MMM_Act1b_Initiate_5594262e-ed7c-4a3d-b3aa-a6705c1f73e5"
local Act1BMimicFlag = "MMM_Act1B_Mimics_e1554499-db23-4a02-b4fa-0a50e8ea2543"
local GithGondolaFlag = "MMM_Act1B_Gondola_40af7e2b-7d22-41bd-b1f9-2747e1be37fb"
local GishraFlag = "MMM_Act1B_Gishra_73aa2d9f-1be8-43b9-ae8b-3df2437cba4b"
local Act1AdamFlag = "MMM_Act1_Adam_f050757b-cfae-4301-a745-dcb73d4b6de7"
local Act1LiamFlag = "MMM_Act1_Liam_88ad30aa-c051-403b-914b-47b3ddd5da53"
local Act1MikeFlag = "MMM_Act1_Mike_ab0233fc-f112-4778-8dd7-da9cad510a63"
local Act1bAdamFlag = "MMM_Act1b_Adam_f5986888-456d-4b43-acdd-5a964397d1b5"
local Act1bLiamFlag = "MMM_Act1b_Liam_2a947065-d6c4-4497-906b-eefd01403341"
local Act1bMikeFlag = "MMM_Act1b_Mike_e0c88f29-8176-4b2c-ab41-412607a99ed0"

--Everything to run on load
local function InitiateMonstersCreche()
    Osi.SetOnStage(SpiritualMonestary1, 0)
    Osi.SetOnStage(SpiritualMonestary2, 0)
    Osi.SetOnStage(SpiritualMonestary3, 0)
    Osi.SetOnStage(SpiritualMonestary4, 0)
    Osi.SetOnStage(MadHand6, 0)
    Osi.SetOnStage(MadHand7, 0)
    Osi.SetOnStage(MadHand8, 0)
end

local function ModifyMonstersCreche()
    if Osi.GetFlag(Act1AdamFlag, Null) == 1 and
    Osi.GetFlag(Act1MikeFlag, Null) == 1 and
    Osi.GetFlag(Act1LiamFlag, Null) == 1 and
    Osi.GetFlag(Act1bAdamFlag, Null) == 0 and
    Osi.GetFlag(Act1bLiamFlag, Null) == 0 and
    Osi.GetFlag(Act1bMikeFlag, Null) == 0 then
        Osi.SetOnStage(Adam1b, 1)
        Osi.SetOnStage(Mike1b, 1)
        Osi.SetOnStage(Liam1b, 1)
    else
        Osi.SetOnStage(Adam1b, 0)
        Osi.SetOnStage(Mike1b, 0)
        Osi.SetOnStage(Liam1b, 0)
    end
end

--if anything needs to be removed
local function RemoveItemsCreche()
    Osi.SetOnStage(MountainMine1, 0)
    Osi.SetOnStage(MountainMine2, 0)
    Osi.SetOnStage(MountainMine3, 0)
    Osi.SetOnStage(MountainMine4, 0)
    Osi.SetOnStage(MountainMine5, 0)
    Osi.SetOnStage(MountainMine6, 0)
end

--If Gith are hostile
local function HostileGith()
    if (Osi.QuestUpdateIsUnlocked(Osi.GetHostCharacter(), "ORI_Avatar_Laezel", "ResolvedPeaceCreche") == 0) then
        Osi.SetFaction(GithTroop1, FHostileGith)
        Osi.SetFaction(GithTroop2, FHostileGith)
        Osi.SetFaction(GithTroop3, FHostileGith)
        Osi.SetFaction(GithTroop4, FHostileGith)
        Osi.SetFaction(GithTroop5, FHostileGith)
        Osi.SetFaction(GithGondola1, FHostileGith)
        Osi.SetFaction(GithGondola2, FHostileGith)
        Osi.SetFaction(GithGondola3, FHostileGith)
        Osi.SetFaction(GithGondola4, FHostileGith)
        Osi.SetFaction(GithGondola5, FHostileGith)
        Osi.SetFaction(GithCathGuard1, FHostileGith)
        Osi.SetFaction(GithCathGuard2, FHostileGith)
        Osi.SetFaction(GithCathGuard3, FHostileGith)
        Osi.SetFaction(GithCathGuard4, FHostileGith)
        Osi.SetFaction(GithCathGuard5, FHostileGith)
    end
end

--Create Mimics
local function CreateAct1BMimics()
    local Act1BChestList = { Act1BChest1, Act1BChest2, Act1BChest3, Act1BChest4, Act1BChest5, Act1BChest6, Act1BChest7, Act1BChest8, Act1BChest9 }
    for _,PossibleMimic in ipairs(Act1BChestList) do
    local IsItAMimic = Ext.Utils.Random(1,5)
        if IsItAMimic == 1 then
            print("Mimic")
            Osi.ApplyStatus(PossibleMimic, "MMM_MIMIC1B", -1, 1, PossibleMimic)
        elseif IsItAMimic == 2 then
            print("Not a mimic, chest not hidden")
        elseif IsItAMimic == 3 then
            print("Not a mimic, chest not hidden")
        elseif IsItAMimic == 4 then
            print("Not a mimic, chest hidden")
            Osi.SetOnStage(PossibleMimic, 0)
        elseif IsItAMimic == 5 then
            print("Not a mimic, chest hidden")
            Osi.SetOnStage(PossibleMimic, 0)
        end
    end
end

function TurnIntoMimic1B(item, character)
    if Osi.IsDead(item) == 1 then
        return
    end
    local x,y,z = Osi.GetPosition(item)
    local MimicSpawnID = Osi.CreateAt(Act1BMimic, x, y, z, 0, 1, '')
    if MimicSpawnID then
        if (Osi.HasActiveStatus(character,"AMBUSH_IMMUNITY") == 1 or Osi.HasPassive(character, "Alert") == 1 or Osi.HasPassive(character, "Surprise_Immunity") == 1) and Osi.IsPlayer(character) == 1 then
            Osi.QRY_StartDialogCustom_Fixed("GLO_PAD_Mimic_Revealed_55471c86-3b69-ccae-d0e3-e8749cf41d9e", character, Null, Null, Null, Null, Null, 1, 1, -1, 1 )
        elseif Osi.HasActiveStatus(character,"AMBUSH_IMMUNITY") ~= 1 and Osi.HasPassive(character, "Alert") ~= 1 and Osi.HasPassive(character, "Surprise_Immunity") ~= 1 and Osi.IsPlayer(character) == 1 then
            Osi.QRY_StartDialogCustom_Fixed("GLO_PAD_Mimic_Surprised_cb5f94c8-ee5b-c17a-959c-64bc6f88b417", character, Null, Null, Null, Null, Null, 1, 1, -1, 1 )
        end
        Osi.MoveAllItemsTo(item, MimicSpawnID, 0, 0, 1)
    end
    Osi.SetOnStage(item, 0)
end

--Chicken Event 2
local function MountainChickenSoccer()
    if MountainChickenTracker == 0 and
    Osi.IsDead(MountainGob1) == 0 and
    Osi.IsDead(MountainChicken) == 0 then
        Ext.Timer.WaitFor(1000, function()
            local ChickenLottery = Ext.Utils.Random(1, 6)
            if ChickenLottery == 1 then
                Osi.CharacterMoveToPosition(MountainChicken, -89.75, 67.1611328125, -195.75, "Sprint", "", 0)
                MountainChickenSoccer()
                Ext.Timer.WaitFor(600, function()
                    Osi.PlayAnimation(MountainGob4, "CMBT_Melee_RHand_01_Attack_f4ac302b-1569-404f-bd52-1fe443e265df", "")
                end)
            elseif ChickenLottery == 2 then
                Osi.CharacterMoveToPosition(MountainChicken, -88.25, 67.1611328125, -196.75, "Sprint", "", 0)
                MountainChickenSoccer()
                Ext.Timer.WaitFor(600, function()
                    Osi.PlayAnimation(MountainGob3, "CMBT_Melee_RHand_01_Attack_f4ac302b-1569-404f-bd52-1fe443e265df", "")
                end)
            elseif ChickenLottery == 3 then
                Osi.CharacterMoveToPosition(MountainChicken, -90.25, 67.162109375, -198.75, "Sprint", "", 0)
                MountainChickenSoccer()
                Ext.Timer.WaitFor(600, function()
                    Osi.PlayAnimation(MountainGob1, "CMBT_Melee_RHand_01_Attack_f4ac302b-1569-404f-bd52-1fe443e265df", "")
                end)
            elseif ChickenLottery == 4 then
                Osi.CharacterMoveToPosition(MountainChicken, -91.863105773926, 67.162109375, -199.76995849609, "Sprint", "", 0)
                MountainChickenSoccer()
                Ext.Timer.WaitFor(600, function()
                    Osi.PlayAnimation(MountainGob5, "CMBT_Melee_RHand_01_Attack_f4ac302b-1569-404f-bd52-1fe443e265df", "")
                end)
            elseif ChickenLottery == 5 then
                Osi.CharacterMoveToPosition(MountainChicken, -92.75, 67.2587890625, -198.75, "Sprint", "", 0)
                MountainChickenSoccer()
                Ext.Timer.WaitFor(600, function()
                    Osi.PlayAnimation(MountainGob2, "CMBT_Melee_RHand_01_Attack_f4ac302b-1569-404f-bd52-1fe443e265df", "")
                end)
            elseif ChickenLottery == 6 then
                Osi.CharacterMoveToPosition(MountainChicken, -91.75, 67.169921875, -196.75, "Sprint", "", 0)
                MountainChickenSoccer()
            end
        end)
    elseif MountainChickenTracker == 1 then
        return
    end
end

--Chicken Kill Timer
local function ChickenKillTimer()
    if Osi.IsDead(MountainGob1) == 0 then
        Ext.Timer.WaitFor(1800000, function()
            if Osi.IsDead(MountainGob1) == 0 then
            Osi.ApplyDamage(MountainChicken, 40, "Piercing", MountainGob1)
            elseif Osi.IsDead(MountainGob1) == 1 then
                return
            end
        end)
    end
end

--Mad Hands Running Around
local function MadHand1Running()
    if Osi.IsDead(MadHand1) == 0 and Osi.IsInCombat(MadHand1) == 0 then
        Ext.Timer.WaitFor(1300, function()
        local MadHand1Roller = Ext.Utils.Random(1, 9)
            if MadHand1Roller == 1 then
                Osi.CharacterMoveToPosition(MadHand1, -108.28685760498, 69.9150390625, -85.434692382812, "Sprint", "", 0)
                MadHand1Running()
            elseif MadHand1Roller == 2 then
                Osi.CharacterMoveToPosition(MadHand1, -104.75, 69.861328125, -84.25, "Sprint", "", 0)
                MadHand1Running()
            elseif MadHand1Roller == 3 then
                Osi.CharacterMoveToPosition(MadHand1, -105.6577911377, 69.974609375, -87.631683349609, "Sprint", "", 0)
                MadHand1Running()
            elseif MadHand1Roller == 4 then
                Osi.CharacterMoveToPosition(MadHand1, -107.755027771, 70.31640625, -90.004768371582, "Sprint", "", 0)
                MadHand1Running()
            elseif MadHand1Roller == 5 then
                Osi.CharacterMoveToPosition(MadHand1, -101.25, 70.1123046875, -88.25, "Sprint", "", 0)
                MadHand1Running()
            elseif MadHand1Roller == 6 then
                Osi.CharacterMoveToPosition(MadHand1, -104.25651550293, 70.04296875, -90.273735046387, "Sprint", "", 0)
                MadHand1Running()
            elseif MadHand1Roller == 7 then
                Osi.CharacterMoveToPosition(MadHand1, -100.54127502441, 69.9443359375, -92.354736328125, "Sprint", "", 0)
                MadHand1Running()
            elseif MadHand1Roller == 8 then
                Osi.CharacterMoveToPosition(MadHand1, -106.45620727539, 70.009895324707, -94.76277923584, "Sprint", "", 0)
                MadHand1Running()
            elseif MadHand1Roller == 9 then
                Osi.CharacterMoveToPosition(MadHand1, -102.72969055176, 69.994140625, -96.102996826172, "Sprint", "", 0)
                MadHand1Running()
            end
        end)
    end
end
local function MadHand2Running()
    if Osi.IsDead(MadHand2) == 0 and Osi.IsInCombat(MadHand2) == 0 then
        Ext.Timer.WaitFor(1600, function()
        local MadHand2Roller = Ext.Utils.Random(1, 9)
            if MadHand2Roller == 1 then
                Osi.CharacterMoveToPosition(MadHand2, -108.28685760498, 69.9150390625, -85.434692382812, "Sprint", "", 0)
                MadHand2Running()
            elseif MadHand2Roller == 2 then
                Osi.CharacterMoveToPosition(MadHand2, -104.75, 69.861328125, -84.25, "Sprint", "", 0)
                MadHand2Running()
            elseif MadHand2Roller == 3 then
                Osi.CharacterMoveToPosition(MadHand2, -105.6577911377, 69.974609375, -87.631683349609, "Sprint", "", 0)
                MadHand2Running()
            elseif MadHand2Roller == 4 then
                Osi.CharacterMoveToPosition(MadHand2, -107.755027771, 70.31640625, -90.004768371582, "Sprint", "", 0)
                MadHand2Running()
            elseif MadHand2Roller == 5 then
                Osi.CharacterMoveToPosition(MadHand2, -101.25, 70.1123046875, -88.25, "Sprint", "", 0)
                MadHand2Running()
            elseif MadHand2Roller == 6 then
                Osi.CharacterMoveToPosition(MadHand2, -104.25651550293, 70.04296875, -90.273735046387, "Sprint", "", 0)
                MadHand2Running()
            elseif MadHand2Roller == 7 then
                Osi.CharacterMoveToPosition(MadHand2, -100.54127502441, 69.9443359375, -92.354736328125, "Sprint", "", 0)
                MadHand2Running()
            elseif MadHand2Roller == 8 then
                Osi.CharacterMoveToPosition(MadHand2, -106.45620727539, 70.009895324707, -94.76277923584, "Sprint", "", 0)
                MadHand2Running()
            elseif MadHand2Roller == 9 then
                Osi.CharacterMoveToPosition(MadHand2, -102.72969055176, 69.994140625, -96.102996826172, "Sprint", "", 0)
                MadHand2Running()
            end
        end)
    end
end
local function MadHand3Running()
    if Osi.IsDead(MadHand3) == 0 and Osi.IsInCombat(MadHand3) == 0 then
        Ext.Timer.WaitFor(2100, function()
        local MadHand3Roller = Ext.Utils.Random(1, 9)
            if MadHand3Roller == 1 then
                Osi.CharacterMoveToPosition(MadHand3, -108.28685760498, 69.9150390625, -85.434692382812, "Sprint", "", 0)
                MadHand3Running()
            elseif MadHand3Roller == 2 then
                Osi.CharacterMoveToPosition(MadHand3, -104.75, 69.861328125, -84.25, "Sprint", "", 0)
                MadHand3Running()
            elseif MadHand3Roller == 3 then
                Osi.CharacterMoveToPosition(MadHand3, -105.6577911377, 69.974609375, -87.631683349609, "Sprint", "", 0)
                MadHand3Running()
            elseif MadHand3Roller == 4 then
                Osi.CharacterMoveToPosition(MadHand3, -107.755027771, 70.31640625, -90.004768371582, "Sprint", "", 0)
                MadHand3Running()
            elseif MadHand3Roller == 5 then
                Osi.CharacterMoveToPosition(MadHand3, -101.25, 70.1123046875, -88.25, "Sprint", "", 0)
                MadHand3Running()
            elseif MadHand3Roller == 6 then
                Osi.CharacterMoveToPosition(MadHand3, -104.25651550293, 70.04296875, -90.273735046387, "Sprint", "", 0)
                MadHand3Running()
            elseif MadHand3Roller == 7 then
                Osi.CharacterMoveToPosition(MadHand3, -100.54127502441, 69.9443359375, -92.354736328125, "Sprint", "", 0)
                MadHand3Running()
            elseif MadHand3Roller == 8 then
                Osi.CharacterMoveToPosition(MadHand3, -106.45620727539, 70.009895324707, -94.76277923584, "Sprint", "", 0)
                MadHand3Running()
            elseif MadHand3Roller == 9 then
                Osi.CharacterMoveToPosition(MadHand3, -102.72969055176, 69.994140625, -96.102996826172, "Sprint", "", 0)
                MadHand3Running()
            end
        end)
    end
end
local function MadHand4Running()
    if Osi.IsDead(MadHand4) == 0 and Osi.IsInCombat(MadHand4) == 0 then
        Ext.Timer.WaitFor(2400, function()
        local MadHand4Roller = Ext.Utils.Random(1, 9)
            if MadHand4Roller == 1 then
                Osi.CharacterMoveToPosition(MadHand4, -108.28685760498, 69.9150390625, -85.434692382812, "Sprint", "", 0)
                MadHand4Running()
            elseif MadHand4Roller == 2 then
                Osi.CharacterMoveToPosition(MadHand4, -104.75, 69.861328125, -84.25, "Sprint", "", 0)
                MadHand4Running()
            elseif MadHand4Roller == 3 then
                Osi.CharacterMoveToPosition(MadHand4, -105.6577911377, 69.974609375, -87.631683349609, "Sprint", "", 0)
                MadHand4Running()
            elseif MadHand4Roller == 4 then
                Osi.CharacterMoveToPosition(MadHand4, -107.755027771, 70.31640625, -90.004768371582, "Sprint", "", 0)
                MadHand4Running()
            elseif MadHand4Roller == 5 then
                Osi.CharacterMoveToPosition(MadHand4, -101.25, 70.1123046875, -88.25, "Sprint", "", 0)
                MadHand4Running()
            elseif MadHand4Roller == 6 then
                Osi.CharacterMoveToPosition(MadHand4, -104.25651550293, 70.04296875, -90.273735046387, "Sprint", "", 0)
                MadHand4Running()
            elseif MadHand4Roller == 7 then
                Osi.CharacterMoveToPosition(MadHand4, -100.54127502441, 69.9443359375, -92.354736328125, "Sprint", "", 0)
                MadHand4Running()
            elseif MadHand4Roller == 8 then
                Osi.CharacterMoveToPosition(MadHand4, -106.45620727539, 70.009895324707, -94.76277923584, "Sprint", "", 0)
                MadHand4Running()
            elseif MadHand4Roller == 9 then
                Osi.CharacterMoveToPosition(MadHand4, -102.72969055176, 69.994140625, -96.102996826172, "Sprint", "", 0)
                MadHand4Running()
            end
        end)
    end
end
local function MadHand5Running()
    if Osi.IsDead(MadHand5) == 0 and Osi.IsInCombat(MadHand5) == 0 then
        Ext.Timer.WaitFor(2700, function()
            local MadHand5Roller = Ext.Utils.Random(1, 9)
            if MadHand5Roller == 1 then
                Osi.CharacterMoveToPosition(MadHand5, -108.28685760498, 69.9150390625, -85.434692382812, "Sprint", "", 0)
                MadHand5Running()
            elseif MadHand5Roller == 2 then
                Osi.CharacterMoveToPosition(MadHand5, -104.75, 69.861328125, -84.25, "Sprint", "", 0)
                MadHand5Running()
            elseif MadHand5Roller == 3 then
                Osi.CharacterMoveToPosition(MadHand5, -105.6577911377, 69.974609375, -87.631683349609, "Sprint", "", 0)
                MadHand5Running()
            elseif MadHand5Roller == 4 then
                Osi.CharacterMoveToPosition(MadHand5, -107.755027771, 70.31640625, -90.004768371582, "Sprint", "", 0)
                MadHand5Running()
            elseif MadHand5Roller == 5 then
                Osi.CharacterMoveToPosition(MadHand5, -101.25, 70.1123046875, -88.25, "Sprint", "", 0)
                MadHand5Running()
            elseif MadHand5Roller == 6 then
                Osi.CharacterMoveToPosition(MadHand5, -104.25651550293, 70.04296875, -90.273735046387, "Sprint", "", 0)
                MadHand5Running()
            elseif MadHand5Roller == 7 then
                Osi.CharacterMoveToPosition(MadHand5, -100.54127502441, 69.9443359375, -92.354736328125, "Sprint", "", 0)
                MadHand5Running()
            elseif MadHand5Roller == 8 then
                Osi.CharacterMoveToPosition(MadHand5, -106.45620727539, 70.009895324707, -94.76277923584, "Sprint", "", 0)
                MadHand5Running()
            elseif MadHand5Roller == 9 then
                Osi.CharacterMoveToPosition(MadHand5, -102.72969055176, 69.994140625, -96.102996826172, "Sprint", "", 0)
                MadHand5Running()
            end
        end)
    end
end

--Summon more hands
local function MadHandSummon()
    Osi.SetOnStage(MadHand6, 1)
    Osi.SetOnStage(MadHand7, 1)
    Osi.SetOnStage(MadHand8, 1)
end

--Gith Troops
local function MountainArmyMarch()
    print("Gith troops enter combat")
    Osi.SetOnStage(MountainTrigger1, 0)
    Osi.SetOnStage(MountainTrigger2, 0)
    Osi.CharacterMoveToPosition(GithTroop1, -75.302528381348, 60.90625, -113.02704620361, "Sprint", "", 0)
    Osi.CharacterMoveToPosition(GithTroop2, -76.977813720703, 61.296875, -114.75482177734, "Sprint", "", 0)
    Osi.CharacterMoveToPosition(GithTroop3, -76.75, 61.6982421875, -111.25, "Sprint", "", 0)
    Osi.CharacterMoveToPosition(GithTroop4, -73.935775756836, 60.646484375, -111.71125030518, "Sprint", "", 0)
    Osi.CharacterMoveToPosition(GithTroop5, -72.959915161133, 60.1796875, -116.07563781738, "Sprint", "", 0)
    Ext.Timer.WaitFor(2000, function()
        Osi.SetHostileAndEnterCombat(FNeutralGith, FAbsoluteUndead, GithTroop1, DeathShephard)
        Osi.SetHostileAndEnterCombat(FHostileGith, FAbsoluteUndead, GithTroop1, DeathShephard)
    end)
end

--Absolute Troops
local function AbsoluteMarch()
    print("Absolute troops enter combat")
    Osi.CharacterMoveToPosition(AbsoluteTroop1, -91.041519165039, 65.4560546875, -119.41915893555, "Run", "", 0)
    Osi.CharacterMoveToPosition(AbsoluteTroop2, -90.889595031738, 65.4453125, -114.77012634277, "Run", "", 0)
    Osi.CharacterMoveToPosition(AbsoluteTroop3, -89.532600402832, 65.25390625, -116.68051147461, "Run", "", 0)
    Ext.Timer.WaitFor(3000, function()
        Osi.SetHostileAndEnterCombat(FNeutralGith, FAbsoluteUndead, GithTroop1, AbsoluteTroop1)
        Osi.SetHostileAndEnterCombat(FHostileGith, FAbsoluteUndead, GithTroop1, AbsoluteTroop1)
    end)
end

---Gondola Disembark
local function GondolaDisembark()
    Ext.Timer.WaitFor(19000, function()
        if Osi.IsInCombat(GithGondola1) == 0 then
            Osi.CharacterMoveToPosition(GithGondola1, -50.037498474121, 51.1728515625, -79.485023498535, "Walk", "", 0)
            Osi.CharacterMoveToPosition(GithGondola2, -51.25, 51.4482421875, -76.25, "Walk", "", 0)
            Osi.CharacterMoveToPosition(GithGondola3, -46.783931732178, 51.2421875, -77.92219543457, "Walk", "", 0)
            Osi.CharacterMoveToPosition(GithGondola4, -49.690654754639, 51.1728515625, -74.994194030762, "Walk", "", 0)
            Osi.CharacterMoveToPosition(GithGondola5, -46.64875793457, 51.216796875, -75.075157165527, "Walk", "", 0)
        elseif Osi.IsInCombat(GithGondola1) == 1 then
            return
        end
    end)
end

--Lathander Stealing Summon Spiritweapons
local function LathanderStealing()
    for i,v in ipairs(Ext.Entity.GetAllEntitiesWithComponent("ServerCharacter")) do
        local charIDstealing = v.Uuid.EntityUuid
        if IsPlayer(charIDstealing) == 1 then
            Osi.ShowNotification(charIDstealing, "You think you can just steal the Blood of Lathander?")
        end
    end
    Ext.Timer.WaitFor(2000, function()
        Osi.PlayEffectAtPosition("b21ec9bd-5f35-446e-cc8f-5458962c118e", 74, 23.5, 72, 10)
        Osi.SetOnStage(SpiritualMonestary1, 1)
        Osi.SetOnStage(SpiritualMonestary2, 1)
        Osi.SetOnStage(SpiritualMonestary3, 1)
        Osi.SetOnStage(SpiritualMonestary4, 1)
    end)
end

--Dawnmaster Check
local function DawnmasterCheck()
    print("Checker Turned On")
    --Zevlor
    if Osi.IsDead("S_DEN_TieflingLeader_475200ee-cc3c-4dbe-84b1-1820c02ea26a") == 1 then
        DawnmasterTally = DawnmasterTally +1;
        print("Zevlor " .. DawnmasterTally)
    end
    --Kagha
    if Osi.IsDead("S_DEN_DruidLeader_95eb2b0b-a522-4ea5-8167-c5f4d1418156") == 1 then
        DawnmasterTally = DawnmasterTally +1;
        print("Kagha " .. DawnmasterTally)
    end
    --Gale Hand
    if Osi.GetFlag("ORI_DarkUrge_State_HackedGale_a18d0203-6c1e-b758-242a-c01c60b243a6", GetHostCharacter()) == 1 then
    DawnmasterTally = DawnmasterTally +1;
    print("Gale " .. DawnmasterTally)
    end
    --Paralyzed Girl
    if Osi.GetFlag("DEN_General_State_PotionTieflingHealed_0dece41d-7a76-193e-1a6b-1efc7e4497ab", "S_DEN_Tiefling_005_e5319db6-ea86-43cc-9fd0-5ec1e0eab492") == 1 then
    DawnmasterTally = DawnmasterTally -1;
    print("Paralyzed Girl " .. DawnmasterTally)
    end
    --Barcus
    if Osi.IsDead("S_FOR_UnfortunateGnome_6e45a00b-bad2-40bb-9403-147b9e92d976") == 1 then
        DawnmasterTally = DawnmasterTally +1;
        print("Barcus " .. DawnmasterTally)
    end
    --Arabella
    if Osi.IsDead("S_DEN_SnakeKid_02257c1c-bbec-4ae3-9bcb-31c75a0a982f") == 1 then
        DawnmasterTally = DawnmasterTally +1;
        print("Arabella " .. DawnmasterTally)
    end
    --Alfira
    if Osi.GetFlag("LOW_Elfsong_State_AlfiraPermaDefeated", GetHostCharacter()) == 1 then
        DawnmasterTally = DawnmasterTally +1;
        print("Alfira " .. DawnmasterTally)
    end
    --Priestess Gut
    if Osi.IsDead("S_GOB_GoblinPriest_b983c336-9a14-4e9b-adb9-4689e7e0afa9") == 0 then
        DawnmasterTally = DawnmasterTally +1;
        print("Gut " .. DawnmasterTally)
    end
    --Dror Ragzlin
    if Osi.IsDead("S_GOB_GoblinKing_11337af0-6a57-426b-a820-c4b00923dd54") == 0 then
        DawnmasterTally = DawnmasterTally +1;
        print("Dror " .. DawnmasterTally)
    end
    --Hag Outcome
    if Osi.GetFlag("LOW_HagSurvivors_Debug_MayrinaDiedInActI_331b726e-28cc-447f-8bec-6f3d9c8fc796", GetHostCharacter()) == 1 then
        DawnmasterTally = DawnmasterTally +1;
        print("HagMayrinaDead " .. DawnmasterTally)
    end
    if Osi.GetFlag("HAG_Hag_State_HagTookMother_38dc6752-5ab3-e108-64ed-fe63971d69fd", GetHostCharacter()) == 1 then
        DawnmasterTally = DawnmasterTally +1;
        print("HagMayrinaTaken " .. DawnmasterTally)
    end
    --Dragon Bridge
    if Osi.QuestUpdateIsUnlocked(Osi.GetHostCharacter(), "ORI_Avatar_Laezel", "ResolvedPeaceCreche") == 1 then
        DawnmasterTally = DawnmasterTally -1;
        print("Gith Peaceful " .. DawnmasterTally)
    end
    --Myconids
    if Osi.IsDead("S_UND_MyconidSovereign_ea0f222f-eaad-4d83-bbcd-cbae51ccf265") == 1 then
        DawnmasterTally = DawnmasterTally +1;
        print("Myconids " .. DawnmasterTally)
    end
    --Noblestalk
    if Osi.GetFlag("UND_MushroomHunter_Event_AteMushroom_617a7a68-9ce9-26e8-883d-7cb98665540c", GetHostCharacter()) == 1 then
        DawnmasterTally = DawnmasterTally +1;
        print("Noblestalk " .. DawnmasterTally)
    end
    --Nere
    if Osi.GetFlag("UND_DuergarCamp_State_SidedDrow_9c15716b-2e73-3bde-7e1c-8580aa4b1850", GetHostCharacter()) == 1 then
        DawnmasterTally = DawnmasterTally +1;
        print("Nere " .. DawnmasterTally)
    end
    --Gith egg
    if Osi.GetFlag("CRE_Expeditioner_Event_GiveGithEggTo_c7666c11-1970-430a-b04f-847870341af6", GetHostCharacter()) == 1 then
        DawnmasterTally = DawnmasterTally +1;
        print("Gith Egg " .. DawnmasterTally)
    end
    --Stole key
    if Osi.IsDead(SpiritualMonestary1) == 1 then
        DawnmasterTally = DawnmasterTally +3;
        print("Stole key " .. DawnmasterTally)
    end
    --Tally all
    Ext.Timer.WaitFor(100, function()
        print("TOTAL DAWNMASTER SCORE - " .. DawnmasterTally)
        if DawnmasterTally >= 4 then
            for i,v in ipairs(Ext.Entity.GetAllEntitiesWithComponent("ServerCharacter")) do
                Ext.Timer.WaitFor(100, function()
                    local DawnmasterBad = v.Uuid.EntityUuid
                    if IsPlayer(DawnmasterBad) == 1 then
                        Osi.ShowNotification(DawnmasterBad,"You are not worthy to gaze upon the Blood of Lathander")
                        Ext.Timer.WaitFor(2000, function()
                            Osi.SetFaction(Dawnmaster, "Evil_NPC_64321d50-d516-b1b2-cfac-2eb773de1ff6")
                            Osi.SetHostileAndEnterCombat("Evil_NPC_64321d50-d516-b1b2-cfac-2eb773de1ff6", "Hero_Player1_6545a015-1b3d-66a4-6a0e-6ec62065cdb7", Dawnmaster, GetHostCharacter())
                        end)
                    end
                end)
            end
        elseif DawnmasterTally <= 3 then
            for i,v in ipairs(Ext.Entity.GetAllEntitiesWithComponent("ServerCharacter")) do
                Ext.Timer.WaitFor(100, function()
                    local DawnmasterGood = v.Uuid.EntityUuid
                    if IsPlayer(DawnmasterGood) == 1 then
                        Osi.ShowNotification(DawnmasterGood, "You are worthy of the Blood of Lathander")
                        Ext.Timer.WaitFor(1000, function()
                            Osi.PlayEffect(Dawnmaster, "b21ec9bd-5f35-446e-cc8f-5458962c118e", "", 2)
                            Osi.SetOnStage(Dawnmaster, 0)
                            Osi.ApplyStatus("MMM_DAWNMASTER_e4c919df-5e52-4a68-ab65-4d550debfcdb", "PEACEFUL_RESOLUTION_XP", -1, 1, GetHostCharacter())
                        end)
                    end
                end)
            end
        end
    end)
end

--Dawnmaster Execution
local function DawnmasterExecution()
    if DawnmasterRollResult >= 1 then
        DawnmasterSelector = Ext.Utils.Random(1, 2)
        if DawnmasterSelector == 1 then
            Osi.ApplyStatus(Dawnmaster, "MMM_DAWNMASTERFLAMESTRIKE", 6, 1, Dawnmaster)
            local DMEntity = Ext.Entity.Get(Dawnmaster)
            local DMpos = DMEntity.Transform.Transform.Translate
            for _, entity in ipairs(Ext.Entity.GetAllEntitiesWithComponent("BaseHp")) do
                print("FlameStrikeShow1")
                Playeruuid = entity.Uuid.EntityUuid
                if IsPlayer(Playeruuid) == 1 then
                    print("FlameStrikeShow2")
                    Osi.CreateAtObject("Helper_Invisible_A_4cc75168-a81e-4a5c-85cd-1bab8d7bb641", Playeruuid, 0, 0, "MMM_DAWNMASTER_TARGETINGF", 1)
                    local DMtarget = entity.Transform.Transform.Translate
                    local distance = math.sqrt((DMpos[1] - DMtarget[1])^2 + (DMpos[2] - DMtarget[2])^2 + (DMpos[3] - DMtarget[3])^2)
                    if distance <= 50 then
                        print("FlameStrikeShow3")
                        local x, y, z = Osi.GetPosition(Playeruuid)
                        Ext.Osiris.RegisterListener("TurnStarted", 1, "after", function(object)
                            if object == Dawnmaster and DawnmasterOff <= 1 then
                                Osi.UseSpellAtPosition(Dawnmaster, "MMM_Target_LATHANDERFLAMESTRIKE", x, y, z, 1)
                                DawnmasterOff = DawnmasterOff + 1;
                            end
                        end)
                    end
                end
            end
        elseif DawnmasterSelector == 2 then
            Osi.ApplyStatus(Dawnmaster, "MMM_DAWNMASTERSUNBEAM", 6, 1, Dawnmaster)
            local DMEntity = Ext.Entity.Get(Dawnmaster)
            local DMpos = DMEntity.Transform.Transform.Translate
            for _, entity in ipairs(Ext.Entity.GetAllEntitiesWithComponent("BaseHp")) do
                print("SunbeamShow1")
                Playeruuid = entity.Uuid.EntityUuid
                if IsPlayer(Playeruuid) == 1 then
                    print("SunbeamShow2")
                    Osi.CreateAtObject("Helper_Invisible_A_4cc75168-a81e-4a5c-85cd-1bab8d7bb641", Playeruuid, 0, 0, "MMM_DAWNMASTER_TARGETINGS", 1)
                    local DMtarget = entity.Transform.Transform.Translate
                    local distance = math.sqrt((DMpos[1] - DMtarget[1])^2 + (DMpos[2] - DMtarget[2])^2 + (DMpos[3] - DMtarget[3])^2)
                    if distance <= 50 then
                        print("SunbeamShow3")
                        local x, y, z = Osi.GetPosition(Playeruuid)
                        Ext.Osiris.RegisterListener("TurnStarted", 1, "after", function(object)
                            if object == Dawnmaster and DawnmasterOff <= 1 then
                                Osi.UseSpellAtPosition(Dawnmaster, "MMM_Zone_LATHANDERSUNBEAM", x, y, z, 1)
                                DawnmasterOff = DawnmasterOff + 1;
                            end
                        end)
                    end
                end
            end
        end
    elseif DawnmasterRollResult <= 0 then
        Osi.ApplyStatus(Dawnmaster, "MMM_DAWNMASTERGENERIC", 6, 1, Dawnmaster)
        DawnmasterSelector = Ext.Utils.Random(1, 2)
        if DawnmasterSelector == 1 then
            print("FlameStrikeNoShow1")
            local DMEntity = Ext.Entity.Get(Dawnmaster)
            local DMpos = DMEntity.Transform.Transform.Translate
            for _, entity in ipairs(Ext.Entity.GetAllEntitiesWithComponent("BaseHp")) do
                print("FlameStrikeNoShow2")
                Playeruuid = entity.Uuid.EntityUuid
                if IsPlayer(Playeruuid) == 1 then
                    print("FlameStrikeNoShow3")
                    local DMtarget = entity.Transform.Transform.Translate
                    local distance = math.sqrt((DMpos[1] - DMtarget[1])^2 + (DMpos[2] - DMtarget[2])^2 + (DMpos[3] - DMtarget[3])^2)
                    if distance <= 50 then
                        print("FlameStrikeNoShow4")
                        local x, y, z = Osi.GetPosition(Playeruuid)
                        Ext.Osiris.RegisterListener("TurnStarted", 1, "after", function(object)
                            if object == Dawnmaster and DawnmasterOff <= 1 then
                                Osi.UseSpellAtPosition(Dawnmaster, "MMM_Target_LATHANDERFLAMESTRIKE", x, y, z, 1)
                                DawnmasterOff = DawnmasterOff + 1;
                            end
                        end)
                    end
                end
            end
        elseif DawnmasterSelector == 2 then
            print("SunbeamNoShow1")
            local DMEntity = Ext.Entity.Get(Dawnmaster)
            local DMpos = DMEntity.Transform.Transform.Translate
            for _, entity in ipairs(Ext.Entity.GetAllEntitiesWithComponent("BaseHp")) do
                print("SunbeamNoShow2")
                Playeruuid = entity.Uuid.EntityUuid
                if IsPlayer(Playeruuid) == 1 then
                    print("SunbeamNoShow3")
                    local DMtarget = entity.Transform.Transform.Translate
                    local distance = math.sqrt((DMpos[1] - DMtarget[1])^2 + (DMpos[2] - DMtarget[2])^2 + (DMpos[3] - DMtarget[3])^2)
                    if distance <= 50 then
                        print("SunbeamNoShow4")
                        local x, y, z = Osi.GetPosition(Playeruuid)
                        Ext.Osiris.RegisterListener("TurnStarted", 1, "after", function(object)
                            if object == Dawnmaster and DawnmasterOff <= 1 then
                                Osi.UseSpellAtPosition(Dawnmaster, "MMM_Zone_LATHANDERSUNBEAM", x, y, z, 1)
                                DawnmasterOff = DawnmasterOff + 1;
                            end
                        end)
                    end
                end
            end
        end
    end
end

--Counters
Ext.Events.SessionLoaded:Subscribe(function()
    MountainTrigger = 0
    DawnmasterTally = 0
    DawnmasterOff = 0
    MountainChickenTracker = 0
    MadHandPun1 = 0
    MadHandPun2 = 0
    MadHandPun3 = 0
    MadHandPun4 = 0
    MadHandPun5 = 0
    MadHandPun6 = 0
    MadHandPun7 = 0
    DawnmasterRollResult = 0
end)

--Prepared Boost
Ext.Events.SessionLoaded:Subscribe(function()
    PrepareDuration = 0
end)

local function PreparedBoost()
    for i,v in ipairs(Ext.Entity.GetAllEntitiesWithComponent("ServerCharacter")) do
        local charIDprepared = v.Uuid.EntityUuid
        if Osi.IsTagged(charIDprepared, "25bf5042-5bf6-4360-8df8-ab107ccb0d37") == 1 then
            Osi.ApplyStatus(charIDprepared, "MMM_PREPARED", PrepareDuration, 1, charIDprepared)
        end
    end
end

---------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------
-------------------------------------------LISTENERS-----------------------------------------------------
---------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------

--What to run on loading level
Ext.Osiris.RegisterListener("LevelGameplayStarted", 2, "after", function(level_name, is_editor_mode)
    if (level_name ~= "CRE_Main_A") then 
        return 
    end
    if Osi.GetFlag(Act1BMimicFlag, Null) == 0 then
        Osi.SetFlag(Act1BMimicFlag, Null, 0, 1)
        CreateAct1BMimics()
    end
    if Osi.GetFlag(InitiateAct1b, Null) == 0 then
        Osi.SetFlag(InitiateAct1b, Null, 0, 1)
        InitiateMonstersCreche()
        RemoveItemsCreche()
    end
    ModifyMonstersCreche()
    HostileGith()
    MountainChickenSoccer()
    ChickenKillTimer()
    MadHand1Running()
    MadHand2Running()
    MadHand3Running()
    MadHand4Running()
    MadHand5Running()
end)

--Enter Combat Listener
Ext.Osiris.RegisterListener("EnteredCombat", 2, "after", function (object, combat)
    if object == MountainGob1 then
        MountainChickenTracker = MountainChickenTracker + 1;
        Osi.CharacterMoveToPosition(MountainChicken, -103.09066009521, 67.4404296875, -203.5530090332, "Sprint", "", 0)
        Ext.Timer.WaitFor(3000, function()
            Osi.SetOnStage(MountainChicken, 0)
        end)
    end
    if object == DeathShephard then 
        Ext.Osiris.RegisterListener("CombatRoundStarted", 2, "after", function(combatGuid, round)
            if round == 3 then
                AbsoluteMarch()
            end
        end)
    end
    if object == MadHandSorc then
        Ext.Osiris.RegisterListener("CombatRoundStarted", 2, "after", function(combatGuid, round)
            if round == 1 then
                MadHandPun1 = MadHandPun1 + 1;
            end
            if round == 2 then
                MadHandPun2 = MadHandPun2 + 1;
            end
            if round == 3 then
                MadHandPun3 = MadHandPun3 + 1;
            end
            if round == 4 then
                MadHandPun4 = MadHandPun4 + 1;
            end
            if round == 5 then
                MadHandPun5 = MadHandPun5 + 1;
            end
            if round == 6 then
                MadHandPun6 = MadHandPun6 + 1;
            end
            if round == 7 then
                MadHandPun7 = MadHandPun7 + 1;
            end
        end)
    end
    if object == CrecheCheckpoint then 
        Osi.SetFaction(Prisoner1, FAbsoluteUndead)
        Osi.SetFaction(Prisoner2, FAbsoluteUndead)
        Osi.SetFaction(Prisoner3, FAbsoluteUndead)
        Osi.SetHostileAndEnterCombat(FAbsoluteUndead, FCrecheCP, Prisoner1, CrecheCheckpoint)
        Osi.SetHostileAndEnterCombat(FAbsoluteUndead, FCrecheCP, Prisoner2, CrecheCheckpoint)
        Osi.SetHostileAndEnterCombat(FAbsoluteUndead, FCrecheCP, Prisoner3, CrecheCheckpoint)
        Osi.ApplyStatus(Prisoner1, "MMM_CRECHEPRISONBREAK", 6)
    end
    --Gondola Flag Set
    if object == GithGondola1 then
        Osi.SetFlag(GithGondolaFlag, Null, 0, 1)
    end
end)

--Turn started listener
Ext.Osiris.RegisterListener("TurnStarted", 1, "before", function(object)
    --Mad Hand Sorc
    if object == MadHandSorc then
        if MadHandPun1 == 1 then
            Osi.ApplyStatus(MadHandSorc, "MMM_HANDPUN5", -1)
            Ext.Timer.WaitFor(3000, function()
                Osi.RemoveStatus(MadHandSorc, "MMM_HANDPUN5", "")
                MadHandPun1 = 0
            end)
        elseif MadHandPun2 == 1 then
            Osi.ApplyStatus(MadHandSorc, "MMM_20MOREHANDS", -1)
            Ext.Timer.WaitFor(3000, function()
                Osi.RemoveStatus(MadHandSorc, "MMM_20MOREHANDS", "")
                Osi.SetOnStage(MadHand6, 1)
                Osi.SetOnStage(MadHand7, 1)
                Osi.SetOnStage(MadHand8, 1)
                MadHandPun2 = 0
            end)
        elseif MadHandPun3 == 1 then
            Osi.ApplyStatus(MadHandSorc, "MMM_HANDPUN1", -1)
            Ext.Timer.WaitFor(3000, function()
                Osi.RemoveStatus(MadHandSorc, "MMM_HANDPUN1", "")
                MadHandPun3 = 0
            end)
        elseif MadHandPun4 == 1 then
            Osi.ApplyStatus(MadHandSorc, "MMM_HANDPUN2", -1)
            Ext.Timer.WaitFor(3000, function()
                Osi.RemoveStatus(MadHandSorc, "MMM_HANDPUN2", "")
                MadHandPun4 = 0
            end)
        elseif MadHandPun5 == 1 then
            Osi.ApplyStatus(MadHandSorc, "MMM_HANDPUN3", -1)
            Ext.Timer.WaitFor(3000, function()
                Osi.RemoveStatus(MadHandSorc, "MMM_HANDPUN3", "")
                MadHandPun5 = 0
            end)
        elseif MadHandPun6 == 1 then
            Osi.ApplyStatus(MadHandSorc, "MMM_HANDPUN4", -1)
            Ext.Timer.WaitFor(3000, function()
                Osi.RemoveStatus(MadHandSorc, "MMM_HANDPUN4", "")
                MadHandPun6 = 0
            end)
        elseif MadHandPun7 == 1 then
            Osi.ApplyStatus(MadHandSorc, "MMM_HANDPUN6", -1)
            Ext.Timer.WaitFor(3000, function()
                Osi.RemoveStatus(MadHandSorc, "MMM_HANDPUN6", "")
                MadHandPun7 = 0
            end)
        end
    end
    --Dawnmaster
    if object == Dawnmaster and Osi.GetHitpoints(Dawnmaster) <= 200 and DawnmasterOff == 0 then
        DawnmasterOff = DawnmasterOff + 1;
        Osi.ApplyStatus(Dawnmaster, "MMM_LATHANDERSBLESSING", 12, 1, Dawnmaster)
        local DMEntity = Ext.Entity.Get(Dawnmaster)
        local DMpos = DMEntity.Transform.Transform.Translate
        for _, entity in ipairs(Ext.Entity.GetAllEntitiesWithComponent("BaseHp")) do
            Playeruuid = entity.Uuid.EntityUuid
            if IsPlayer(Playeruuid) == 1 then
                local DMtarget = entity.Transform.Transform.Translate
                local distance = math.sqrt((DMpos[1] - DMtarget[1])^2 + (DMpos[2] - DMtarget[2])^2 + (DMpos[3] - DMtarget[3])^2)
                if distance <= 30 then
                    Osi.RequestPassiveRoll(Playeruuid, Dawnmaster, "", "Arcana", "Act1_Challenging_5e7ff0e9-6c80-459c-a636-3a3e8417a61a", 0, "DawnmasterRoll")
                end
            end
        end
    end
end)

--Open item listener
Ext.Osiris.RegisterListener("Opened", 1, "before", function(item)
end)

--Use item listener
Ext.Osiris.RegisterListener("UseStarted", 2, "after", function(character, item)
    if Osi.HasActiveStatus(item, "MMM_MIMIC1B") == 1 then
        TurnIntoMimic1B(item, character)
    end
end)

--Destroy object listener
Ext.Osiris.RegisterListener("DestroyedBy", 4, "before", function(item, destroyer, destroyerOwner, storyActionID)
    if Osi.HasActiveStatus(item, "MMM_MIMIC1B") == 1 then
        TurnIntoMimic1B(item, character)
    end
end)

--Death listener
Ext.Osiris.RegisterListener("Died", 1, "after", function(character)
    if character == SpiritualMonestary1 then
        Osi.PlayEffect(SpiritualMonestary1, "b21ec9bd-5f35-446e-cc8f-5458962c118e", "", 2)
        Osi.SetOnStage(SpiritualMonestary1, 0)
    end
    if character == SpiritualMonestary2 then
        Osi.PlayEffect(SpiritualMonestary2, "b21ec9bd-5f35-446e-cc8f-5458962c118e", "", 2)
        Osi.SetOnStage(SpiritualMonestary2, 0)
    end
    if character == SpiritualMonestary3 then
        Osi.PlayEffect(SpiritualMonestary3, "b21ec9bd-5f35-446e-cc8f-5458962c118e", "", 2)
        Osi.SetOnStage(SpiritualMonestary3, 0)
    end
    if character == SpiritualMonestary4 then
        Osi.PlayEffect(SpiritualMonestary4, "b21ec9bd-5f35-446e-cc8f-5458962c118e", "", 2)
        Osi.SetOnStage(SpiritualMonestary4, 0)
    end
    if character == Dawnmaster then
        Osi.PlayEffect(Dawnmaster, "b21ec9bd-5f35-446e-cc8f-5458962c118e", "", 2)
        Osi.SetOnStage(Dawnmaster, 0)
    end
    --Team Trajectile
    if character == Adam1b then
        Osi.SetFlag(Act1bAdamFlag, Null, 0, 1)
        Osi.SetCanFight(Adam1b, 0)
        Osi.Resurrect(Adam1b, "", 0)
        Osi.AddBoosts(Adam1b, "Invulnerable", "", Adam1b)
        Ext.Timer.WaitFor(2000, function()
            Osi.CharacterMoveToPosition(Adam1b, 92.672912597656, -7.9482421875, -12.47047328949, "Sprint", "", 0)
            Osi.ApplyStatus(Adam1b, "MMM_ADAMRUNAWAY1", 6, 1, "")
            Ext.Timer.WaitFor(2500, function()
                Osi.CharacterMoveToPosition(Adam1b, 92.672912597656, -7.9482421875, -12.47047328949, "Sprint", "", 0)
                Ext.Timer.WaitFor(4000, function()
                    Osi.PlayEffect(Adam1b, "1b923cb2-133a-25bd-6cbf-f808ca1cb8d2", "", 1)
                    Ext.Timer.WaitFor(500, function()
                        Osi.SetOnStage(Adam1b, 0)
                    end)
                end)
            end)
        end)
    end
    if character == Liam1b then
        Osi.SetFlag(Act1bLiamFlag, Null, 0, 1)
        Osi.SetCanFight(Liam1b, 0)
        Osi.Resurrect(Liam1b, "", 0)
        Osi.AddBoosts(Liam1b, "Invulnerable", "", Liam1b)
        Ext.Timer.WaitFor(2000, function()
            Osi.CharacterMoveToPosition(Liam1b, 92.672912597656, -7.9482421875, -12.47047328949, "Sprint", "", 0)
            Osi.ApplyStatus(Liam1b, "MMM_LIAMRUNAWAY1", 6, 1, "")
            Ext.Timer.WaitFor(2500, function()
                Osi.CharacterMoveToPosition(Liam1b, 92.672912597656, -7.9482421875, -12.47047328949, "Sprint", "", 0)
                Ext.Timer.WaitFor(4000, function()
                    Osi.PlayEffect(Liam1b, "1b923cb2-133a-25bd-6cbf-f808ca1cb8d2", "", 1)
                    Ext.Timer.WaitFor(500, function()
                        Osi.SetOnStage(Liam1b, 0)
                    end)
                end)
            end)
        end)
    end
    if character == Mike1b then
        Osi.SetFlag(Act1bMikeFlag, Null, 0, 1)
        Osi.SetCanFight(Mike1b, 0)
        Osi.Resurrect(Mike1b, "", 0)
        Osi.AddBoosts(Mike1b, "Invulnerable", "", Mike1b)
        Ext.Timer.WaitFor(2000, function()
            Osi.CharacterMoveToPosition(Mike1b, 92.672912597656, -7.9482421875, -12.47047328949, "Sprint", "", 0)
            Osi.ApplyStatus(Mike1b, "MMM_MIKERUNAWAY1", 6, 1, "")
            Ext.Timer.WaitFor(2500, function()
                Osi.CharacterMoveToPosition(Mike1b, 92.672912597656, -7.9482421875, -12.47047328949, "Sprint", "", 0)
                Ext.Timer.WaitFor(4000, function()
                    Osi.PlayEffect(Mike1b, "1b923cb2-133a-25bd-6cbf-f808ca1cb8d2", "", 1)
                    Ext.Timer.WaitFor(500, function()
                        Osi.SetOnStage(Mike1b, 0)
                    end)
                end)
            end)
        end)
    end
end)

--Saw something listener
Ext.Osiris.RegisterListener("Saw", 3, "after", function(character, targetcharacter, targetwassneaking)
end)

--Status Applied listener
Ext.Osiris.RegisterListener("StatusApplied", 4, "before", function(object, status, cause, storyActionID)
    --Gith Trigger 1
    if status == "MMM_MOUNTAINMARCH1" then
        if MountainTrigger == 0 then
            MountainTrigger = MountainTrigger + 1;
            MountainArmyMarch()
        elseif MountainTrigger == 1 then
            return
        end
    end
    --Gith Trigger 2
    if status == "MMM_MOUNTAINMARCH2" then
        if MountainTrigger == 0 then
            MountainTrigger = MountainTrigger + 1;
            MountainArmyMarch()
        elseif MountainTrigger == 1 then
            return
        end
    end
    --Shadow Knight Trigger
    if status == "MMM_MOUNTAINMARCH3" then
        Osi.CharacterMoveToPosition(ShadowSpawnDoor, -142.17744445801, 51.1376953125, -142.08139038086, "Walk", "", 0)
        Osi.SetOnStage(MountainTriggerDoor, 0)
    end
    --Gish'ra Trigger
    if status == "MMM_GISHRAMARCH" then
        if Osi.GetFlag(GishraFlag, Null) == 0 then
            for _, entity in ipairs(Ext.Entity.GetAllEntitiesWithComponent("BaseHp")) do
                local GishraTag = entity.Uuid.EntityUuid
                if Osi.IsTagged(GishraTag, "25bf5042-5bf6-4360-8df8-ab107ccb0d37") == 1 then
                    if Osi.GetDistanceTo(GishCrechTrigger, GishraTag) <= 20 then
                        Osi.RequestPassiveRoll(GishraTag, CrecheGishra1, "", "Perception", "Act1_VeryHard_8986db4d-09af-46ee-9781-ac88ec10fa0e", 0, "GishraDetectRoll")
                    end
                end
            end
            Osi.SetOnStage(GishCrechTrigger, 0)
            Osi.SetFlag(GishraFlag, Null, 0, 1)
        end
    end
    -- if status == "MMM_GISHRAMARCH" then
    --     Osi.RequestPassiveRoll(object, CrecheGishra1, "", "Perception", "Act1_Challenging_5e7ff0e9-6c80-459c-a636-3a3e8417a61a", 0, "GishraDetectRoll")
    --     Osi.SetOnStage(GishCrechTrigger, 0)
    -- end
    --Dawnmaster Trigger
    if status == "MMM_DAWNMASTERMARCH" then
        DawnmasterCheck()
        print("Entered dawnmaster checker")
        Osi.RemoveStatus(Dawnmaster, "MMM_DAWNMASTERDETECT", "")
    end
end)

--Roll listener
Ext.Osiris.RegisterListener("RollResult", 6, "after", function(eventName, roller, rollsubject, resultType, isActiveRoll, criticality)
    --Gondola detect roll
    if eventName == "GondolaRoll" then
        if resultType == 1 then
            ShowNotification(roller, "You see Gith riding the gondola towards you.")
            PrepareDuration = 30
            PreparedBoost()
        elseif resultType == 0 then
            return
        end
    end
    --Gish'ra detect roll
    if eventName == "GishraDetectRoll" then
        if resultType == 1 then
            ShowNotification(roller, "You feel eyes staring at you.")
            PrepareDuration = 18
            PreparedBoost()
            Osi.RemoveStatus(CrecheGishra1, "INVISIBLE", "")
            Osi.RemoveStatus(CrecheGishra2, "INVISIBLE", "")
        elseif resultType == 0 then
            return
        end
    end
    --Stealing Blood of Lathander thing
    if rollsubject == "S_CRE_WeaponsPuzzle_HiddenDoor_5e2d9891-0dfb-4d00-9691-6ed69a50c58a" and
    resultType == 1 and
    isActiveRoll == 1 then
       LathanderStealing()
    end
    if eventName == "DawnmasterRoll" then
        if resultType == 1 then
            DawnmasterRollResult = DawnmasterRollResult + 1;
            Ext.Timer.WaitFor(100, function()
                DawnmasterExecution()
            end)
        elseif resultType == 0 then
            Ext.Timer.WaitFor(100, function()
                DawnmasterExecution()
            end)
        end
    end
end)

--Flag listener
Ext.Osiris.RegisterListener("FlagSet", 3, "after", function(flag, speaker, dialogInstance)
    if flag == "CRE_Exterior_State_FerryActive_6d076322-51c2-461f-bf29-8b44e4dca804" then
        if Osi.GetFlag(GithGondolaFlag, Null) == 0 then
            GondolaDisembark()
            Osi.SetFlag(GithGondolaFlag, Null, 0, 1)
            Ext.Timer.WaitFor(9000, function()
                for _, entity in ipairs(Ext.Entity.GetAllEntitiesWithComponent("BaseHp")) do
                    local GithGondolaTag = entity.Uuid.EntityUuid
                    if Osi.IsTagged(GithGondolaTag, "25bf5042-5bf6-4360-8df8-ab107ccb0d37") == 1 then
                        if Osi.GetDistanceTo(GondolaLever, GithGondolaTag) <= 20 then
                            Osi.RequestPassiveRoll(entity, cause, "", "Perception", "Act1_VeryHard_8986db4d-09af-46ee-9781-ac88ec10fa0e", 0, "GondolaRoll")
                        end
                    end
                end
            end)
        end
    end
    -- if flag == "CRE_Exterior_State_FerryActive_6d076322-51c2-461f-bf29-8b44e4dca804" and
    -- Osi.IsOnStage(GondolaTrigger) == 1 then
    --     Osi.SetOnStage(GondolaTrigger, 0)
    --     GondolaDisembark()
    --     Ext.Timer.WaitFor(9000, function()
    --         local PlayerByElevator = Osi.GetClosestAlivePlayer("S_CRE_ElevatorUpLever_000_c4d746c1-22e4-4dfd-9be9-33e40428850a")
    --         Osi.RequestPassiveRoll(PlayerByElevator, GithGondola1, "", "Perception", "Act1_Challenging_5e7ff0e9-6c80-459c-a636-3a3e8417a61a", 0, "GondolaRoll")
    --     end)
    -- end
end)

--Event listener
Ext.Osiris.RegisterListener("EntityEvent", 2, "before", function(object, event)
    if event == "MMM_DAWNMASTER_TARGETINGF" then
        Osi.ApplyStatus(object, "MMM_AVOIDFLAMESTRIKE", -1, 1, "NULL_00000000-0000-0000-0000-000000000000")
        Ext.Osiris.RegisterListener("TurnStarted", 1, "after", function(object2)
            if object2 == Dawnmaster then 
                Osi.RequestDelete(object)
            end
        end)
    end
    if event == "MMM_DAWNMASTER_TARGETINGS" then
        Osi.ApplyStatus(object, "MMM_AVOIDSUNBEAM", -1, 1, "NULL_00000000-0000-0000-0000-000000000000")
        Ext.Osiris.RegisterListener("TurnStarted", 1, "after", function(object2)
            if object2 == Dawnmaster then 
                Osi.RequestDelete(object)
            end
        end)
    end
end)

--On Stage listener
Ext.Osiris.RegisterListener("WentOnStage", 2, "after", function(object, isOnStageNow)
end)