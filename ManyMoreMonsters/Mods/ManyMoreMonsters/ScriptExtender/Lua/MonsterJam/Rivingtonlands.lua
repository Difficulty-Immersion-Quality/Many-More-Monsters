--BGO_Main_A
--Why did I make so many things oh god
local Null = "NULL_00000000-0000-0000-0000-000000000000"
local Act3Mimic = "MMM_ACT3MIMIC_c3a019a8-bbae-4591-ad10-0f45580be467"
local Adam3 = "MMM_THIEFTRIO3_70a7129a-f413-4d07-b297-4cf540d0c6cc"
local Liam3 = "MMM_THIEFTRIO3_db593fe5-9fb7-48a6-b5f9-d7a6becc7865"
local Mike3 = "MMM_THIEFTRIO3_872af681-9bd6-464e-91f6-29992903f3ab"
local SeaCreature101 = "MMM_SEACREATURE1_45b8fd96-ca15-448d-aac1-a5197a9ddef7"
local SeaCreature102 = "MMM_SEACREATURE1_2a4ee504-3e91-4334-a27b-8ae6129b4997"
local SeaCreature103 = "MMM_SEACREATURE1_805adc8d-047e-491a-a931-db16f5b97589"
local SeaCreatureMound = "DEC_HAR_Fish_Barrel_A_006_91e67f45-a976-4a79-bae1-70091f694a86"
local SeaCreature201 = "MMM_SEACREATURE2_f29443b5-4d60-4942-bd4b-d340d7c192a8"
local SeaCreature202 = "MMM_SEACREATURE2_0ab5e757-776c-4c82-bbab-1fe2dd92a8ff"
local SeaCreature203 = "MMM_SEACREATURE2_f4ea38b5-d822-44c9-b241-18f05f28a86a"
local SeaCreatureChest = "CONT_GEN_Crate_Wood_B_108_c46e610a-bfb8-4995-b915-cae888084c9d"
local HillGiant = "MMM_HILLGIANT_5bcd9958-dbe6-402a-9f7b-4bcf09a16974"
local SusRefugee1 = "MMM_SUSREFUGEE_80d10f30-08a1-443f-b45d-4e5e55f473a9"
local SusRefugee2 = "MMM_SUSREFUGEE_a28a24bc-b7a3-46b2-b9f1-ab173ea37b1f"
local SusRefugee3 = "MMM_SUSREFUGEE_b878bbc0-e622-436e-a35d-e781ab79629d"
local SuccubusRoot = "MMM_SUCCUBUS_7ecffc82-c69e-46d4-95ab-fe1737334116"
local IncubusRoot = "MMM_INCUBUS_caa4cb59-d5b0-4dfe-a5da-fba628830896"
local RivingtonPatrol1 = "MMM_RIVINGTONPATROL_6e8518a8-c7c3-4e78-9515-43e620d82472"
local RivingtonPatrol2 = "MMM_RIVINGTONPATROL_0944a300-cdd8-4d9d-9ac3-cf8e90b9b23e"
local RivingtonPatrol3 = "MMM_RIVINGTONPATROL_3f954530-e65e-4739-9d21-97557f729981"
local RivingtonPatrol4 = "MMM_RIVINGTONPATROL_d8a8f915-d71f-4207-8a89-8161ef87ebf8"

--Mimic Chests
local Act3Chest1 = "MMM_ACT3ACHEST_7716db14-e9a1-410f-b214-b24526112811"
local Act3Chest2 = "MMM_ACT3ACHEST_a4bfefc2-f3e0-4462-8315-9884cb21f35e"
local Act3Chest3 = "MMM_ACT3ACHEST_bffa505b-2465-46b1-b150-a6240899ac87"
local Act3Chest4 = "MMM_ACT3ACHEST_a376e66b-2321-4baf-b197-2a986ad86e28"
local Act3Chest5 = "MMM_ACT3ACHEST_9879e58d-a6de-4938-82cd-f135559e8965"
local Act3Chest6 = "MMM_ACT3ACHEST_bb5a1b88-7354-4bbd-9e1a-568da411de68"
local Act3Chest7 = "MMM_ACT3ACHEST_e29549c9-c60e-434a-913b-4790ccc7402b"
local Act3Chest8 = "MMM_ACT3ACHEST_ead92772-2b52-41d9-9474-b0b7c02d2e89"
local Act3Chest9 = "MMM_ACT3ACHEST_3b577bba-fbb2-45dc-a197-f9a344d33e40"
local Act3Chest10 = "MMM_ACT3ACHEST_7691ad55-f418-4c24-ab10-431439fddd17"
local Act3Chest11 = "MMM_ACT3ACHEST_c40be486-b6de-44ba-927e-fa7355389cce"
local Act3Chest12 = "MMM_ACT3ACHEST_10f5ae46-6771-4db6-9f0c-0e6b313ab348"
local Act3Chest13 = "MMM_ACT3ACHEST_5be1cf07-3c5f-4dc5-ac3d-f4ec97965974"
local Act3Chest14 = "MMM_ACT3ACHEST_57ef76dc-4794-43bc-b513-0a4fef47a9f0"
local Act3Chest15 = "MMM_ACT3ACHEST_f911e055-9b88-466b-bd34-813333d2cff3"
local Act3Chest16 = "MMM_ACT3ACHEST_bd0f24b2-7d56-47cc-97b1-a14bac41f63a"

--Factions
local FAbsoluteUndead = "60749034-59cb-4551-b5ea-07d1edd617a9"
local FOrpheusGish = "ACT2B_INT_Orpheus_ad62a159-c6fb-43ae-a682-63c139905874"
local FNeutral = "cfb709b3-220f-9682-bcfb-6f0d8837462e"
local FPlayer = "Hero_Player1_6545a015-1b3d-66a4-6a0e-6ec62065cdb7"
local FEvil = "Evil_NPC_64321d50-d516-b1b2-cfac-2eb773de1ff6"

--Item List
local RivingtonDeadChicken = "S_WYR_RefugeeCamp_DeadChicken_000_c492aa1c-ce7f-4a12-8b27-8950e7f4dd3d"
local BODE = "MMM_BODE_803e4140-5d5d-45d1-bc01-af309f8d94ee"

--Flags
local InitiateAct3 = "MMM_Act3_Initiate_97abff9b-6ae8-4aac-a9f6-efab3d0474fc"
local Act3MimicFlag = "MMM_Act3_Mimics_6eb1cc13-8597-411c-b43c-68cac6e42ebe"
local Act3SeaCreatures1Flag = "MMM_Act3_SeaCreatures1_a01e04a5-2a48-47f8-95a0-25d3571db7bf"
local Act3SeaCreatures2Flag = "MMM_Act3_SeaCreatures2_f93da608-0bba-4eda-87ed-3f468fd4fc14"
local Act3HillGiantFlag = "MMM_Act3_HillGiant_0fcf3ed1-7fae-4c81-b137-3bf9aceeee7e"
local Act2AdamFlag = "MMM_Act2_Adam_f054a046-1bec-45b2-967c-a30cda09db62"
local Act2LiamFlag = "MMM_Act2_Liam_e8712d83-3a05-4948-9934-f2842e5cf360"
local Act2MikeFlag = "MMM_Act2_Mike_67d7b164-a43d-4c44-b64e-a5d449c02e8a"
local Act3AdamFlag = "MMM_Act3_Adam_5c52b843-5241-45bc-b1fb-01c01a36abe9"
local Act3LiamFlag = "MMM_Act3_Liam_a91c83b9-f510-44cc-b851-ac303e8ed86b"
local Act3MikeFlag = "MMM_Act3_Mike_73c1a7d3-f348-43e8-b689-7f17abb1b05a"

--On Load
local function InitiateMonstersRivingtonlands()
    if Osi.GetFlag(Act3SeaCreatures1Flag, Null) == 0 then
        Osi.ApplyStatus(SeaCreatureMound, "MMM_RIVINGTONSEADETECT1", -1, 1, SeaCreatureMound)
    end
    if Osi.GetFlag(Act3SeaCreatures2Flag, Null) == 0 then
        Osi.ApplyStatus(SeaCreatureChest, "MMM_RIVINGTONSEADETECT2", -1, 1, SeaCreatureChest)
    end
    Osi.SetOnStage(SeaCreature101, 0)
    Osi.SetOnStage(SeaCreature102, 0)
    Osi.SetOnStage(SeaCreature103, 0)
    Osi.SetOnStage(SeaCreature201, 0)
    Osi.SetOnStage(SeaCreature202, 0)
    Osi.SetOnStage(SeaCreature203, 0)
    Osi.SetOnStage(HillGiant, 0)
end

local function ModifyMonstersRivington()
    if Osi.GetFlag(Act2AdamFlag, Null) == 1 and
    Osi.GetFlag(Act2MikeFlag, Null) == 1 and
    Osi.GetFlag(Act2LiamFlag, Null) == 1 and
    Osi.GetFlag(Act3AdamFlag, Null) == 0 and
    Osi.GetFlag(Act3MikeFlag, Null) == 0 and
    Osi.GetFlag(Act3LiamFlag, Null) == 0 then
        Osi.SetOnStage(Adam3, 1)
        Osi.SetOnStage(Mike3, 1)
        Osi.SetOnStage(Liam3, 1)
    else
        Osi.SetOnStage(Adam3, 0)
        Osi.SetOnStage(Mike3, 0)
        Osi.SetOnStage(Liam3, 0)
    end
end

--Create Mimics
local function CreateAct3Mimics()
    local Act3ChestList = { Act3Chest1, Act3Chest2, Act3Chest3, Act3Chest4, Act3Chest5, Act3Chest6, Act3Chest7, Act3Chest8, Act3Chest9, Act3Chest10,
                            Act3Chest11, Act3Chest12, Act3Chest13, Act3Chest14, Act3Chest15, Act3Chest16 }
    for _,PossibleMimic in ipairs(Act3ChestList) do
    local IsItAMimic = Ext.Utils.Random(1,5)
        if IsItAMimic == 1 then
            print("Mimic")
            Osi.ApplyStatus(PossibleMimic, "MMM_MIMIC3", -1, 1, PossibleMimic)
        elseif IsItAMimic == 2 then
            print("Not a mimic, chest not hidden")
        elseif IsItAMimic == 3 then
            print("Not a mimic, chest not hidden")
        elseif IsItAMimic == 4 then
            print("Not a mimic, chest hidden")
            Osi.SetOnStage(PossibleMimic, 0)
        elseif IsItAMimic == 5 then
            print("Not a mimic, chest hidden")
            Osi.SetOnStage(PossibleMimic, 0)
        end
    end
end

function TurnIntoMimic3(item, character)
    if Osi.IsDead(item) == 1 then
        return
    end
    local x,y,z = Osi.GetPosition(item)
    local MimicSpawnID = Osi.CreateAt(Act3Mimic, x, y, z, 0, 1, '')
    if MimicSpawnID then
        if (Osi.HasActiveStatus(character,"AMBUSH_IMMUNITY") == 1 or Osi.HasPassive(character, "Alert") == 1 or Osi.HasPassive(character, "Surprise_Immunity") == 1) and Osi.IsPlayer(character) == 1 then
            Osi.QRY_StartDialogCustom_Fixed("GLO_PAD_Mimic_Revealed_55471c86-3b69-ccae-d0e3-e8749cf41d9e", character, Null, Null, Null, Null, Null, 1, 1, -1, 1 )
        elseif Osi.HasActiveStatus(character,"AMBUSH_IMMUNITY") ~= 1 and Osi.HasPassive(character, "Alert") ~= 1 and Osi.HasPassive(character, "Surprise_Immunity") ~= 1 and Osi.IsPlayer(character) == 1 then
            Osi.QRY_StartDialogCustom_Fixed("GLO_PAD_Mimic_Surprised_cb5f94c8-ee5b-c17a-959c-64bc6f88b417", character, Null, Null, Null, Null, Null, 1, 1, -1, 1 )
        end
        Osi.MoveAllItemsTo(item, MimicSpawnID, 0, 0, 1)
    end
    Osi.SetOnStage(item, 0)
end

--Sea Creatures
local function SeaCreature1Attack()
    Osi.SetOnStage(SeaCreature101, 1)
    Osi.SetOnStage(SeaCreature102, 1)
    Osi.SetOnStage(SeaCreature103, 1)
    Osi.UseSpellAtPosition(SeaCreature101, "Projectile_Jump", 65.64143371582, 0.8603515625, 92.970504760742, 1)
    Osi.UseSpellAtPosition(SeaCreature102, "Projectile_Jump", 69.11190032959, 1.2705078125, 91.941635131836, 1)
    Osi.UseSpellAtPosition(SeaCreature103, "Projectile_Jump", 71.75, 0.369140625, 96.75, 1)
    Ext.Timer.WaitFor(700, function()
        Osi.PlayEffectAtPosition("7e3869fb-18e6-bf38-378e-eb8807ed1641", 70.75, 0.052566528320312, 99.75, 20)
        Ext.Timer.WaitFor(1000, function()
            Osi.Die(SeaCreatureMound, 0, SeaCreatureMound, 0, 1, 500)
        end)
    end)
end

local function SeaCreature2Attack()
    Osi.SetOnStage(SeaCreature201, 1)
    Osi.SetOnStage(SeaCreature202, 1)
    Osi.SetOnStage(SeaCreature203, 1)
    Osi.UseSpellAtPosition(SeaCreature201, "Projectile_Jump", -91.25, -0.30078125, 102.25, 1)
    Osi.UseSpellAtPosition(SeaCreature202, "Projectile_Jump", -90.487930297852, 2.4921875, 107.23223114014, 1)
    Osi.UseSpellAtPosition(SeaCreature203, "Projectile_Jump", -86.25, -0.115234375, 97.25, 1)
    Ext.Timer.WaitFor(700, function()
        Osi.PlayEffectAtPosition("7e3869fb-18e6-bf38-378e-eb8807ed1641", -80.329879760742, -2.1445188522339, 107.9024810791, 20)
        Ext.Timer.WaitFor(1000, function()
            Osi.Die(SeaCreatureChest, 0, SeaCreatureChest, 0, 1, 500)
        end)
    end)
end

--Hill Giant
local function HillGiantAttack()
    Osi.SetOnStage(HillGiant, 1)
    Osi.UseSpellAtPosition(HillGiant, "Projectile_Jump", 104.91307067871, 55.8115234375, -54.232204437256, 1)
    Ext.Timer.WaitFor(1500, function()
        Osi.ApplyStatus(HillGiant, "MMM_HILLGIANTSPEAK", 6, 1, "")
    end)
end

--Githyanki Patrol
local function GithPatrolRoute()
    if Osi.IsInCombat(RivingtonPatrol1) == 0 and 
    Osi.IsDead(RivingtonPatrol1) == 0 and 
    Osi.IsTagged(RivingtonPatrol1, "e45d5440-4a29-42e1-845d-890ae8e82a63") == 0 and
    Osi.IsTagged(RivingtonPatrol2, "e45d5440-4a29-42e1-845d-890ae8e82a63") == 0 and
    Osi.IsTagged(RivingtonPatrol3, "e45d5440-4a29-42e1-845d-890ae8e82a63") == 0 and
    Osi.IsTagged(RivingtonPatrol4, "e45d5440-4a29-42e1-845d-890ae8e82a63") == 0 then
        Osi.CharacterMoveToPosition(RivingtonPatrol1, 7.766809463501, 41.3662109375, -21.354127883911, "Walk", "", 0)
        Osi.CharacterMoveToPosition(RivingtonPatrol2, 8.766809463501, 41.3662109375, -22.354127883911, "Walk", "", 0)
        Osi.CharacterMoveToPosition(RivingtonPatrol3, 5.766809463501, 41.3662109375, -21.354127883911, "Walk", "", 0)
        Osi.CharacterMoveToPosition(RivingtonPatrol4, 6.766809463501, 41.3662109375, -22.354127883911, "Walk", "", 0)
        Ext.Timer.WaitFor(6000, function()
            if Osi.IsInCombat(RivingtonPatrol1) == 0 and Osi.IsDead(RivingtonPatrol1) == 0 then
                Osi.CharacterMoveToPosition(RivingtonPatrol1, 14.475222587585, 41.84375, -24.964761734009, "Walk", "", 0)
                Osi.CharacterMoveToPosition(RivingtonPatrol2, 15.475222587585, 41.84375, -23.964761734009, "Walk", "", 0)
                Osi.CharacterMoveToPosition(RivingtonPatrol3, 12.475222587585, 41.84375, -25.964761734009, "Walk", "", 0)
                Osi.CharacterMoveToPosition(RivingtonPatrol4, 13.475222587585, 41.84375, -26.964761734009, "Walk", "", 0)
                Ext.Timer.WaitFor(6000, function()
                    if Osi.IsInCombat(RivingtonPatrol1) == 0 and Osi.IsDead(RivingtonPatrol1) == 0 then
                        Osi.CharacterMoveToPosition(RivingtonPatrol1, 19.822704315186, 43.2392578125, -37.82287597656, "Walk", "", 0)
                        Osi.CharacterMoveToPosition(RivingtonPatrol2, 18.822704315186, 43.2392578125, -38.82287597656, "Walk", "", 0)
                        Osi.CharacterMoveToPosition(RivingtonPatrol3, 20.822704315186, 43.2392578125, -35.82287597656, "Walk", "", 0)
                        Osi.CharacterMoveToPosition(RivingtonPatrol4, 21.822704315186, 43.2392578125, -36.82287597656, "Walk", "", 0)
                        Ext.Timer.WaitFor(6000, function()
                            if Osi.IsInCombat(RivingtonPatrol1) == 0 and Osi.IsDead(RivingtonPatrol1) == 0 then
                                Osi.CharacterMoveToPosition(RivingtonPatrol1, 17.612157821655, 44.5712890625, -47.634712219238, "Walk", "", 0)
                                Osi.CharacterMoveToPosition(RivingtonPatrol2, 18.612157821655, 44.5712890625, -47.634712219238, "Walk", "", 0)
                                Osi.CharacterMoveToPosition(RivingtonPatrol3, 16.612157821655, 44.5712890625, -46.634712219238, "Walk", "", 0)
                                Osi.CharacterMoveToPosition(RivingtonPatrol4, 16.612157821655, 44.5712890625, -47.634712219238, "Walk", "", 0)
                                Ext.Timer.WaitFor(6000, function()
                                    if Osi.IsInCombat(RivingtonPatrol1) == 0 and Osi.IsDead(RivingtonPatrol1) == 0 then
                                        Osi.CharacterMoveToPosition(RivingtonPatrol1, 13.508633613586, 45.6591796875, -55.585548400879, "Walk", "", 0)
                                        Osi.CharacterMoveToPosition(RivingtonPatrol2, 14.508633613586, 45.6591796875, -55.585548400879, "Walk", "", 0)
                                        Osi.CharacterMoveToPosition(RivingtonPatrol3, 12.508633613586, 45.6591796875, -54.585548400879, "Walk", "", 0)
                                        Osi.CharacterMoveToPosition(RivingtonPatrol4, 12.508633613586, 45.6591796875, -55.585548400879, "Walk", "", 0)
                                        Ext.Timer.WaitFor(6000, function()
                                            if Osi.IsInCombat(RivingtonPatrol1) == 0 and Osi.IsDead(RivingtonPatrol1) == 0 then
                                                Osi.CharacterMoveToPosition(RivingtonPatrol1, 11.389042854309, 47.83203125, -66.319076538086, "Walk", "", 0)
                                                Osi.CharacterMoveToPosition(RivingtonPatrol2, 12.389042854309, 47.83203125, -66.319076538086, "Walk", "", 0)
                                                Osi.CharacterMoveToPosition(RivingtonPatrol3, 9.389042854309, 47.83203125, -66.319076538086, "Walk", "", 0)
                                                Osi.CharacterMoveToPosition(RivingtonPatrol4, 101.389042854309, 47.83203125, -66.319076538086, "Walk", "", 0)
                                                Ext.Timer.WaitFor(7000, function()
                                                    if Osi.IsInCombat(RivingtonPatrol1) == 0 and Osi.IsDead(RivingtonPatrol1) == 0 then
                                                        Osi.CharacterMoveToPosition(RivingtonPatrol1, 2.9711270332336, 49.98046875, -71.273628234863, "Walk", "", 0)
                                                        Osi.CharacterMoveToPosition(RivingtonPatrol2, 3.9711270332336, 49.98046875, -72.273628234863, "Walk", "", 0)
                                                        Osi.CharacterMoveToPosition(RivingtonPatrol3, 1.9711270332336, 49.98046875, -73.273628234863, "Walk", "", 0)
                                                        Osi.CharacterMoveToPosition(RivingtonPatrol4, 1.9711270332336, 49.98046875, -70.273628234863, "Walk", "", 0)
                                                        Ext.Timer.WaitFor(7000, function()
                                                            if Osi.IsInCombat(RivingtonPatrol1) == 0 and Osi.IsDead(RivingtonPatrol1) == 0 then
                                                                Osi.CharacterMoveToPosition(RivingtonPatrol1, -8.0088748931885, 47.671875, -68.871948242188, "Walk", "", 0)
                                                                Osi.CharacterMoveToPosition(RivingtonPatrol2, -9.0088748931885, 47.671875, -68.871948242188, "Walk", "", 0)
                                                                Osi.CharacterMoveToPosition(RivingtonPatrol3, -6.0088748931885, 47.671875, -68.871948242188, "Walk", "", 0)
                                                                Osi.CharacterMoveToPosition(RivingtonPatrol4, -7.0088748931885, 47.671875, -68.871948242188, "Walk", "", 0)
                                                                Ext.Timer.WaitFor(8000, function()
                                                                    if Osi.IsInCombat(RivingtonPatrol1) == 0 and Osi.IsDead(RivingtonPatrol1) == 0 then
                                                                        Osi.CharacterMoveToPosition(RivingtonPatrol1, -15.244285583496, 46.8095703125, -61.639114379883, "Walk", "", 0)
                                                                        Osi.CharacterMoveToPosition(RivingtonPatrol2, -16.244285583496, 46.8095703125, -61.639114379883, "Walk", "", 0)
                                                                        Osi.CharacterMoveToPosition(RivingtonPatrol3, -13.244285583496, 46.8095703125, -61.639114379883, "Walk", "", 0)
                                                                        Osi.CharacterMoveToPosition(RivingtonPatrol4, -14.244285583496, 46.8095703125, -61.639114379883, "Walk", "", 0)
                                                                        Ext.Timer.WaitFor(7000, function()
                                                                            if Osi.IsInCombat(RivingtonPatrol1) == 0 and Osi.IsDead(RivingtonPatrol1) == 0 then
                                                                                Osi.CharacterMoveToPosition(RivingtonPatrol1, -15.888977050781, 45.9072265625, -50.984764099121, "Walk", "", 0)
                                                                                Osi.CharacterMoveToPosition(RivingtonPatrol2, -16.888977050781, 45.9072265625, -50.984764099121, "Walk", "", 0)
                                                                                Osi.CharacterMoveToPosition(RivingtonPatrol3, -13.888977050781, 45.9072265625, -50.984764099121, "Walk", "", 0)
                                                                                Osi.CharacterMoveToPosition(RivingtonPatrol4, -14.888977050781, 45.9072265625, -50.984764099121, "Walk", "", 0)
                                                                                Ext.Timer.WaitFor(6000, function()
                                                                                    if Osi.IsInCombat(RivingtonPatrol1) == 0 and Osi.IsDead(RivingtonPatrol1) == 0 then
                                                                                        Osi.CharacterMoveToPosition(RivingtonPatrol1, -15.9440574646, 45.0263671875, -41.169185638428, "Walk", "", 0)
                                                                                        Osi.CharacterMoveToPosition(RivingtonPatrol2, -16.9440574646, 45.0263671875, -41.169185638428, "Walk", "", 0)
                                                                                        Osi.CharacterMoveToPosition(RivingtonPatrol3, -13.9440574646, 45.0263671875, -41.169185638428, "Walk", "", 0)
                                                                                        Osi.CharacterMoveToPosition(RivingtonPatrol4, -14.9440574646, 45.0263671875, -41.169185638428, "Walk", "", 0)
                                                                                        Ext.Timer.WaitFor(6000, function()
                                                                                            if Osi.IsInCombat(RivingtonPatrol1) == 0 and Osi.IsDead(RivingtonPatrol1) == 0 then
                                                                                                Osi.CharacterMoveToPosition(RivingtonPatrol1, -12.414402008057, 44.1015625, -33.918991088867, "Walk", "", 0)
                                                                                                Osi.CharacterMoveToPosition(RivingtonPatrol2, -14.414402008057, 44.1015625, -33.918991088867, "Walk", "", 0)
                                                                                                Osi.CharacterMoveToPosition(RivingtonPatrol3, -10.414402008057, 44.1015625, -33.918991088867, "Walk", "", 0)
                                                                                                Osi.CharacterMoveToPosition(RivingtonPatrol4, -11.414402008057, 44.1015625, -33.918991088867, "Walk", "", 0)
                                                                                                Ext.Timer.WaitFor(6000, function()
                                                                                                    if Osi.IsInCombat(RivingtonPatrol1) == 0 and Osi.IsDead(RivingtonPatrol1) == 0 then
                                                                                                        Osi.CharacterMoveToPosition(RivingtonPatrol1, -6.7824816703796, 42.9482421875, -27.735832214355, "Walk", "", 0)
                                                                                                        Osi.CharacterMoveToPosition(RivingtonPatrol2, -7.7824816703796, 42.9482421875, -27.735832214355, "Walk", "", 0)
                                                                                                        Osi.CharacterMoveToPosition(RivingtonPatrol3, -4.7824816703796, 42.9482421875, -27.735832214355, "Walk", "", 0)
                                                                                                        Osi.CharacterMoveToPosition(RivingtonPatrol4, -5.7824816703796, 42.9482421875, -27.735832214355, "Walk", "", 0)
                                                                                                        Ext.Timer.WaitFor(6000, function()
                                                                                                            if Osi.IsInCombat(RivingtonPatrol1) == 0 and Osi.IsDead(RivingtonPatrol1) == 0 then
                                                                                                                Osi.CharacterMoveToPosition(RivingtonPatrol1, 1.6371383666992, 41.5888671875, -20.668397903442, "Walk", "", 0)
                                                                                                                Osi.CharacterMoveToPosition(RivingtonPatrol2, 2.6371383666992, 41.5888671875, -21.668397903442, "Walk", "", 0)
                                                                                                                Osi.CharacterMoveToPosition(RivingtonPatrol3, 0.6371383666992, 41.5888671875, -20.668397903442, "Walk", "", 0)
                                                                                                                Osi.CharacterMoveToPosition(RivingtonPatrol4, 0.6371383666992, 41.5888671875, -22.668397903442, "Walk", "", 0)
                                                                                                                Ext.Timer.WaitFor(6000, function()
                                                                                                                    GithPatrolRoute()
                                                                                                                end)
                                                                                                            end
                                                                                                        end)
                                                                                                    end
                                                                                                end)
                                                                                            end
                                                                                        end)
                                                                                    end
                                                                                end)
                                                                            end
                                                                        end)
                                                                    end
                                                                end)
                                                            end
                                                        end)
                                                    end
                                                end)
                                            end
                                        end)
                                    end
                                end)
                            end
                        end)
                    end
                end)
            end
        end)
    end
end

local function GithPatrolReset()
    if Osi.IsInCombat(RivingtonPatrol1) == 0 and Osi.IsDead(RivingtonPatrol1) == 0 and
    Osi.IsTagged(RivingtonPatrol1, "e45d5440-4a29-42e1-845d-890ae8e82a63") == 0 and
    Osi.IsTagged(RivingtonPatrol2, "e45d5440-4a29-42e1-845d-890ae8e82a63") == 0 and
    Osi.IsTagged(RivingtonPatrol3, "e45d5440-4a29-42e1-845d-890ae8e82a63") == 0 and
    Osi.IsTagged(RivingtonPatrol4, "e45d5440-4a29-42e1-845d-890ae8e82a63") == 0 then
        Osi.TeleportToPosition(RivingtonPatrol1, 3.5899391174316, 41.337890625, -19.74844741821, "", 0, 0, 0, 1, 1)
        Osi.TeleportToPosition(RivingtonPatrol2, 0.98395872116089, 41.4794921875, -18.71282386779, "", 0, 0, 0, 1, 1)
        Osi.TeleportToPosition(RivingtonPatrol3, 4.6132888793945, 41.1552734375, -17.80125617981, "", 0, 0, 0, 1, 1)
        Osi.TeleportToPosition(RivingtonPatrol4, 2.1579284667969, 41.2333984375, -16.7972240448, "", 0, 0, 0, 1, 1)
    end
end


Ext.Events.SessionLoaded:Subscribe(function()
end)

--Prepared Boost
Ext.Events.SessionLoaded:Subscribe(function()
    PrepareDuration = 0
end)

local function PreparedBoost()
    for i,v in ipairs(Ext.Entity.GetAllEntitiesWithComponent("ServerCharacter")) do
        local charIDprepared = v.Uuid.EntityUuid
        if Osi.IsTagged(charIDprepared, "25bf5042-5bf6-4360-8df8-ab107ccb0d37") == 1 then
            Osi.ApplyStatus(charIDprepared, "MMM_PREPARED", PrepareDuration, 1, charIDprepared)
        end
    end
end

---------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------
-------------------------------------------LISTENERS-----------------------------------------------------
---------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------

--What to run on loading level
Ext.Osiris.RegisterListener("LevelGameplayStarted", 2, "after", function(level_name, is_editor_mode)
    if (level_name ~= "BGO_Main_A") then 
        return 
    end
    if Osi.GetFlag(Act3MimicFlag, Null) == 0 then
        Osi.SetFlag(Act3MimicFlag, Null, 0, 1)
        CreateAct3Mimics()
    end
    if Osi.GetFlag(InitiateAct3, Null) == 0 then
        Osi.SetFlag(InitiateAct3, Null, 0, 1)
        InitiateMonstersRivingtonlands()
    end
    ModifyMonstersRivington()
    GithPatrolRoute()
    GithPatrolReset()
end)

--Enter Combat Listener
Ext.Osiris.RegisterListener("EnteredCombat", 2, "after", function (object, combatGuid)
    if object == Adam3 then
        Osi.ApplyStatus(Adam3, "MMM_ADAMCOMBAT", 6, 1, "")
    end
end)

--Turn started listener
Ext.Osiris.RegisterListener("TurnStarted", 1, "before", function(object)
end)

--Osi.AttackedBy
Ext.Osiris.RegisterListener("AttackedBy", 7, "after", function(defender, attackerOwner, attacker2, damageType, damageAmount, damageCause, storyActionID)
end)

--Death listener
Ext.Osiris.RegisterListener("Died", 1, "after", function(character)
     --Team Trajectile
     if character == Adam3 then
        Osi.SetFlag(Act3AdamFlag, Null, 0, 1)
        Osi.SetCanFight(Adam3, 0)
        Osi.Resurrect(Adam3, "", 0)
        Osi.AddBoosts(Adam3, "Invulnerable", "", Adam3)
        Ext.Timer.WaitFor(2000, function()
            Osi.CharacterMoveToPosition(Adam3, 66.855728149414, 54.294921875, -138.26065063477, "Sprint", "", 0)
            Osi.ApplyStatus(Adam3, "MMM_ADAMRUNAWAY1", 6, 1, "")
            Ext.Timer.WaitFor(2500, function()
                Osi.CharacterMoveToPosition(Adam3, 66.855728149414, 54.294921875, -138.26065063477, "Sprint", "", 0)
                Ext.Timer.WaitFor(4000, function()
                    Osi.PlayEffect(Adam3, "1b923cb2-133a-25bd-6cbf-f808ca1cb8d2", "", 1)
                    Ext.Timer.WaitFor(500, function()
                        Osi.SetOnStage(Adam3, 0)
                    end)
                end)
            end)
        end)
    end
    if character == Liam3 then
        Osi.SetFlag(Act3LiamFlag, Null, 0, 1)
        Osi.SetCanFight(Liam3, 0)
        Osi.Resurrect(Liam3, "", 0)
        Osi.AddBoosts(Liam3, "Invulnerable", "", Liam3)
        Ext.Timer.WaitFor(2000, function()
            Osi.CharacterMoveToPosition(Liam3, 66.855728149414, 54.294921875, -138.26065063477, "Sprint", "", 0)
            Osi.ApplyStatus(Liam3, "MMM_LIAMRUNAWAY1", 6, 1, "")
            Ext.Timer.WaitFor(2500, function()
                Osi.CharacterMoveToPosition(Liam3, 66.855728149414, 54.294921875, -138.26065063477, "Sprint", "", 0)
                Ext.Timer.WaitFor(4000, function()
                    Osi.PlayEffect(Liam3, "1b923cb2-133a-25bd-6cbf-f808ca1cb8d2", "", 1)
                    Ext.Timer.WaitFor(500, function()
                        Osi.SetOnStage(Liam3, 0)
                    end)
                end)
            end)
        end)
    end
    if character == Mike3 then
        Osi.SetFlag(Act3MikeFlag, Null, 0, 1)
        Osi.SetCanFight(Mike3, 0)
        Osi.Resurrect(Mike3, "", 0)
        Osi.AddBoosts(Mike3, "Invulnerable", "", Mike3)
        Ext.Timer.WaitFor(2000, function()
            Osi.CharacterMoveToPosition(Mike3, 66.855728149414, 54.294921875, -138.26065063477, "Sprint", "", 0)
            Osi.ApplyStatus(Mike3, "MMM_MIKERUNAWAY1", 6, 1, "")
            Ext.Timer.WaitFor(2500, function()
                Osi.CharacterMoveToPosition(Mike3, 66.855728149414, 54.294921875, -138.26065063477, "Sprint", "", 0)
                Ext.Timer.WaitFor(4000, function()
                    Osi.PlayEffect(Mike3, "1b923cb2-133a-25bd-6cbf-f808ca1cb8d2", "", 1)
                    Ext.Timer.WaitFor(500, function()
                        Osi.SetOnStage(Mike3, 0)
                    end)
                end)
            end)
        end)
    end
end)

--End Combat Listener
Ext.Osiris.RegisterListener("CombatEnded", 1, "after", function(combatGuid)
end)

--Open item listener
Ext.Osiris.RegisterListener("Opened", 1, "before", function(item)
    if item == BODE then
        print("BODE WORKING")
    end
end)

--Character Looted
Ext.Osiris.RegisterListener("CharacterLootedCharacter", 2, "after", function(player, lootedCharacter)
    if lootedCharacter == RivingtonDeadChicken and
    Osi.GetFlag(Act3HillGiantFlag, Null) == 0 then
        Osi.SetFlag(Act3HillGiantFlag, Null, 0, 1)
        HillGiantAttack()
    end
end)

--Use item listener
Ext.Osiris.RegisterListener("UseStarted", 2, "after", function(character, item)
    if Osi.HasActiveStatus(item, "MMM_MIMIC3") == 1 then
        TurnIntoMimic3(item, character)
    end
end)

--Dialog Start Request listener
Ext.Osiris.RegisterListener("DialogStartRequested", 2, "after", function(target, player)  
end)

--Destroy object listener
Ext.Osiris.RegisterListener("DestroyedBy", 4, "before", function(item, destroyer, destroyerOwner, storyActionID)
    if Osi.HasActiveStatus(item, "MMM_MIMIC3") == 1 then
        TurnIntoMimic3(item, character)
    end
end)

--Added To listener
Ext.Osiris.RegisterListener("AddedTo", 3, "after", function(object, inventoryHolder, addType)
end)

--Saw something listener
Ext.Osiris.RegisterListener("Saw", 3, "after", function(character, targetcharacter, targetwassneaking)
    if character == RivingtonPatrol1 and Osi.IsTagged(targetcharacter, "25bf5042-5bf6-4360-8df8-ab107ccb0d37") == 1 then
        Osi.ApplyStatus(RivingtonPatrol1, "MMM_RIVINGTONPATROLSPEAK", 6, 1, "")
    end
end)

--Status Applied listener
Ext.Osiris.RegisterListener("StatusApplied", 4, "before", function(object, status, cause, storyActionID)
    if status == "MMM_RIVINGTONSEAATTACK1" and
    Osi.GetFlag(Act3SeaCreatures1Flag, Null) == 0 then
        print("Sea Creature Aura Applied")
        Osi.SetFlag(Act3SeaCreatures1Flag, Null, 0, 1)
        Osi.RemoveStatus(SeaCreatureMound, "MMM_RIVINGTONSEADETECT1")
        local CWEntity = Ext.Entity.Get(SeaCreature101)
        local CWpos = CWEntity.Transform.Transform.Translate
        for _, entity in ipairs(Ext.Entity.GetAllEntitiesWithComponent("BaseHp")) do
            Playeruuid = entity.Uuid.EntityUuid
            if Osi.IsTagged(Playeruuid, "25bf5042-5bf6-4360-8df8-ab107ccb0d37") == 1 then
                local CWtarget = entity.Transform.Transform.Translate
                local distance = math.sqrt((CWpos[1] - CWtarget[1])^2 + (CWpos[2] - CWtarget[2])^2 + (CWpos[3] - CWtarget[3])^2)
                if distance <= 30 then
                    Osi.RequestPassiveRoll(Playeruuid, SeaCreature101, "", "Perception", "Act1_Challenging_5e7ff0e9-6c80-459c-a636-3a3e8417a61a", 0, "SeaCreature1Roll")
                end
            end
        end
        Ext.Timer.WaitFor(3000, function()
            SeaCreature1Attack()
        end)
    end
    if status == "MMM_RIVINGTONSEAATTACK2" and
    Osi.GetFlag(Act3SeaCreatures2Flag, Null) == 0 then
        print("Sea Creature Aura Applied")
        Osi.SetFlag(Act3SeaCreatures2Flag, Null, 0, 1)
        Osi.RemoveStatus(SeaCreatureMound, "MMM_RIVINGTONSEADETECT2")
        local CWEntity = Ext.Entity.Get(SeaCreature201)
        local CWpos = CWEntity.Transform.Transform.Translate
        for _, entity in ipairs(Ext.Entity.GetAllEntitiesWithComponent("BaseHp")) do
            Playeruuid = entity.Uuid.EntityUuid
            if Osi.IsTagged(Playeruuid, "25bf5042-5bf6-4360-8df8-ab107ccb0d37") == 1 then
                local CWtarget = entity.Transform.Transform.Translate
                local distance = math.sqrt((CWpos[1] - CWtarget[1])^2 + (CWpos[2] - CWtarget[2])^2 + (CWpos[3] - CWtarget[3])^2)
                if distance <= 30 then
                    Osi.RequestPassiveRoll(Playeruuid, SeaCreature201, "", "Perception", "Act1_Challenging_5e7ff0e9-6c80-459c-a636-3a3e8417a61a", 0, "SeaCreature2Roll")
                end
            end
        end
        Ext.Timer.WaitFor(3000, function()
            SeaCreature2Attack()
        end)
    end
end)

--Roll listener
Ext.Osiris.RegisterListener("RollResult", 6, "after", function(eventName, roller, rollsubject, resultType, isActiveRoll, criticality)
    if eventName == "SeaCreature1Roll" then
        if resultType == 1 then
            ShowNotification(roller, "You notice something moving in the water.")
            PrepareDuration = 12
            PreparedBoost()
        elseif resultType == 2 then
            return
        end
    end
    if eventName == "SeaCreature2Roll" then
        if resultType == 1 then
            ShowNotification(roller, "You notice something moving in the water.")
            PrepareDuration = 12
            PreparedBoost()
        elseif resultType == 2 then
            return
        end
    end
    if eventName == "BODERoll" then
        if resultType == 1 then
            ShowNotification(roller, "You see the book emitting magic.")
            PrepareDuration = 12
            PreparedBoost()
        elseif resultType == 2 then
            return
        end
    end
end)

--Flag listener
Ext.Osiris.RegisterListener("FlagSet", 3, "after", function(flag, speaker, dialogInstance)
end)

--Event listener
Ext.Osiris.RegisterListener("EntityEvent", 2, "before", function(object, event)
end)

--Close Book listener
Ext.Osiris.RegisterListener("GameBookInterfaceClosed", 2, "after", function(item, character)
    if item == BODE then
        local CWEntity = Ext.Entity.Get(character)
        local CWpos = CWEntity.Transform.Transform.Translate
        for _, entity in ipairs(Ext.Entity.GetAllEntitiesWithComponent("BaseHp")) do
            Playeruuid = entity.Uuid.EntityUuid
            if IsPlayer(Playeruuid) == 1 then
                local CWtarget = entity.Transform.Transform.Translate
                local distance = math.sqrt((CWpos[1] - CWtarget[1])^2 + (CWpos[2] - CWtarget[2])^2 + (CWpos[3] - CWtarget[3])^2)
                if distance <= 10 then
                    Osi.RequestPassiveRoll(Playeruuid, Null, "", "Arcana", "Act1_Challenging_5e7ff0e9-6c80-459c-a636-3a3e8417a61a", 0, "BODERoll")
                end
            end
        end
        Osi.Die(BODE, 0, BODE, 0, 1, 500)
        Ext.Timer.WaitFor(3000, function()
            RaunchySuc = Osi.CreateAtObject(SuccubusRoot, character, 0, 1, "", 0)
            Osi.SetCombatGroupID(RaunchySuc, "1ae7a736-97c6-4cac-a8b8-d3636c35555a")
            RandyInc = Osi.CreateAtObject(IncubusRoot, character, 0, 1, "", 0)
            Osi.SetCombatGroupID(RandyInc, "1ae7a736-97c6-4cac-a8b8-d3636c35555a")
        end)
    end
end)